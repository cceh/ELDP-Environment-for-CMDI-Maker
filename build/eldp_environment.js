var eldp_environment=function(){"use strict";var e={};return e.name="eldp",e.id="eldp",e.title="ELDP",e.version="1.0.0",e.min_cmdi_maker_version="2.0.9",e.workflow=[],e.languages=[],e.not_allowed_chars=" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:áÁäÄàÀéÉîöÖóÓòÒüÜúÚùÙ",e.l=function(n,t,r){return APP.getTermInActiveLanguage(e.languages,n,t,r)},e.metadataLanguageIDs=[["eng","English"],["ger","German"],["spa","Spanish"],["fra","French"],["rus","Russian"],["ind","Indonesian"],["por","Portuguese"],["arb","Standard Arabic"]],e.init=function(){e.displayMetadataLanguages()},e.displayMetadataLanguages=function(){var n=g("metadata_language_select");dom.setSelectOptions(n,e.metadataLanguageIDs,1,0,!1)},e.settings=function(){return[{title:e.l("settings","calculate_persons_age"),description:e.l("settings","calculate_persons_age_description"),type:"toggle",default_value:!0,name:"radio_age_calc",id:"radio_age_calc"},{title:e.l("settings","global_language_of_metadata"),type:"select",name:"metadata_language",id:"metadata_language_select"},{title:e.l("settings","cmdi_metadata_creator"),description:e.l("settings","cmdi_metadata_creator_description"),type:"text",name:"metadata_creator",id:"metadata_creator",value:"CMDI Maker User"}]},e.recall=function(e){APP.GUI.setToggleValue(g("radio_age_calc"),e.calc_actors_age)},e.getSaveData=function(){var e={};return e.calc_actors_age=g("radio_age_calc").on,e},e.reset=function(){},APP.environments.add(e),e}();eldp_environment.languages[0]={id:"english",name:"English",workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Calculate Person's Age",calculate_persons_age_description:"When this feature is activated, CMDI Maker checks if the age of an person (if it has not been specified already) can be calculated from the person's birth date and the bundle date.<br>When an age can be calculated, it will appear in the output file.<br>(Age = Bundle Date - person's Birth Date)",output_format:"Output Format",export_persons_as_json:"Export persons as JSON",import_persons_from_json_or_imdi:"Import persons from JSON or IMDI",import_persons_description:"Please import UTF-8 encoded files only!",delete_persons_database:"Delete persons Database",delete_persons_database_description:"CMDI Maker saves all your persons in a Web Storage browser database, so that they are kept, even if you close the browser window.",global_language_of_metadata:"Global Language of Metadata",cmdi_metadata_creator:"CMDI Metadata Creator",cmdi_metadata_creator_description:"The CMDI metadata format requires the name of a metadata creator. This is probably you. If so, please type in your name."},languages:{set_global_languages_of_content:"Set Global Languages of Content",or_type_in_iso_code:"or type in ISO code",language_search:"Language Search",result:"result",results:"results",language_name:"Language Name",is_new_global:"is a new Global Content Language",iso_code:"ISO code",not_found_in_db:"not found in database",specify_search_request_at_least_3_chars:"Please specify your search request.\nType in at least 3 characters.",primary_language:"Primary Language",mother_tongue:"Mother Tongue",current_content_languages:"Current Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" removed',additional_information:"Additional Information"},resources:{unknown:"Unknown",create_one_bundle_per_file:"Create one bundle per file",files:"Files",selected_files:"Selected Files",sort_alphabetically:"Sort Files alphabetically",remove:"Remove",clear_file_list:"Clear File List",usage:"Usage",click:"Click",click_to_select:"Select resource, click again to deselect a single resource",shift:"Shift",shift_to_select_multiple:"Hold shift to select multiple resources",escape:"Escape",escape_to_deselect:"Press escape to deselect all resources",size:"Size",path:"Path",last_modified:"Last modified",no_resource_files_imported:"No resource files imported.",fade:"Fade",fade_explanation:"Resources are faded down when they will be included in bundles.<br>This is to prevent selecting them mistakenly.",set_for_all:"Set for all"},persons:{new_person:"New Person",delete_this_person:"Delete this person",sort_persons_alphabetically:"Sort persons alphabetically",persons_alphabetically_sorted:"persons sorted",save_and_duplicate_this_person:"Save and duplicate this person",duplicate_this_person:"Duplicate this person",yes_delete_all_persons:"Yes, delete all persons",no:"No",ok:"OK",confirm_erasing_persons_db:"Really?<br>You want to erase the whole persons database?",all_persons_deleted:"All persons deleted",save_person:"Save person",save_changes_to_this_person:"Save changes to this person",there_are_no_persons:"There are no persons!",persons_imported:"persons imported",person_saved_and_duplicated:"Person saved and duplicated.",give_your_person_a_name_first:"Please give your person a name first.",yes_delete_person:"Yes, delete person",really_erase_before_name:"Really?<br>You want to erase ",really_erase_after_name:"?",person_deleted_before_name:"",person_deleted_after_name:" deleted",there_are_no_persons_yet:"There are no persons yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",please_give_all_persons_a_name_before_creating_new_one:"Please give all your persons a name first, before creating a new one!",really_erase_this_person:"Really?<br>You want to erase this person?",unnamed_person:"Unnamed person"},bundle:{new_bundle:"New Bundle",copy_bundle_1_metadata:"Copy Bundle 1 metadata to all bundles",reset_form:"Reset Form",sort_by_name:"Sort by name",add_to_bundle:"Add to bundle",no_files_have_been_added:"No files have been added.",add_some_files:"Add some files.",new_bundle_has_been_created:"A new bundle has been created.",name:"Name",unnamed_bundle:"Unnamed Bundle",bundle:"Bundle",delete_bundle:"Delete Bundle",expand_bundle:"Expand Bundle",collapse_bundle:"Collapse Bundle",expand_collapse_bundle:"Expand/collapse bundle",no_persons_created_yet:"No persons have been created yet.",create_some_persons:"Create some persons.",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",yes_delete_bundle:"Yes, delete bundle",bundle_deleted:"Bundle deleted",no_bundles_have_been_created_yet:"No bundles have been created yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",this_person_is_already_in_the_bundle:"This person is already in the bundle.",unknown_file_problem__before_filename:"We have a problem.<br>I don't know if this file is a Media File or a Written Resource:",unknown_file_problem__after_filename:"As for now, I will handle it as a written resource. But you really shouldn't do that.",bundle_name_taken_from_eaf:"Bundle name has been taken from EAF file name, since bundle has not been manually named yet.",bundle_date_extracted_from_eaf_file_name:"Bundle date has been extracted from EAF file name",at_least_2_bundles_to_assign_metadata:"There have to be at least 2 bundles to assign metadata from one to another.",bundle_1_metadata_assigned_to_all_bundles:"Bundle 1 metadata assigned to all bundles.",this_function_is_currently_unavailable:"This function is currently unavailable!",no:"No",yes_delete_form:"Yes, delete form",really_reset_form:"Really?<br>You want to reset the form and delete all bundles?",form_reset:"Form reset",specify_local_used_language_name:"Specify local used language name",subject_language:"Subject Language",content_language:"Content Language",working_language:"Working Language",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",object:"Object",file_name:"File Name",size:"Size",copy_metadata:"Copy Metadata",from_bundle_1_to_all_others:"From Bundle 1 to all others",from_2nd_last_to_last_bundle:"From second last to last bundle",elements_to_copy:"Elements to copy",from_where_to_where:"From where to where",metadata_copied:"Metadata copied",bundle_title_taken_from_eaf:"Bundle title has been taken from EAF file name, since bundle has not been manually named yet."},output:{bundles_must_have_proper_name:"All bundles must have proper names! Not allowed chars are: <br>",you_must_create_some_bundles_first:"You must create some bundles first!",every_bundle_must_have_a_project_name:"Every bundle must have a project name!",corpus_must_have_proper_name:"The corpus must have a proper name or no name at all.",bundles_must_have_proper_name:"Every bundle must have a proper name.<br>Unnamed bundles are not allowed.",download_corpus_including_all_bundles:"Download Corpus including all Bundles",download_zip_archive:"Download ZIP archive",not_allowed_chars_are:"Not allowed chars are: ",spaces_are_not_allowed_either:"Space characters are not allowed either.",persons_must_have_valid_birth_year:"Every person must have a valid birth year!",bundles_must_have_one_language:"Every bundle must have at least one language.",download_zip_archive:"Download ZIP archive"},really_overwrite_data:"Do you really want to overwrite data?",yes_overwrite_data:"Yes, overwrite data"},eldp_environment.languages[1]={id:"german",name:"Deutsch",workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Automatische Altersberechnung von Personen",calculate_persons_age_description:"Wenn diese Funktion aktiviert ist, prüft CMDI Maker, ob das Alter einer Person (wenn es noch nicht angegeben worden ist) aus dem Geburtsdatum der Person und dem Datum des Bundles berechnet werden kann.<br>Wenn ein Alter berechnet werden kann, erscheint dieses in der generierten XML-Datei.<br>(Alter = Datum der Session - Geburtsdatum der Person)",output_format:"Ausgabeformat",export_persons_as_json:"Personen als JSON exportieren",import_persons_from_json:"Personen aus JSON importieren",import_persons_description:"Bitte importiere nur Dateien mit der Zeichenkodierung UTF-8!",delete_persons_database:"Alle Personen löschen",global_language_of_metadata:"Globale Metadaten-Sprache",cmdi_metadata_creator:"CMDI: Urheber der Metadaten",cmdi_metadata_creator_description:"Das CMDI-Metadatenformat setzt die Angabe eines Urhebers voraus. Das bist wahrscheinlich du! Gib in diesem Fall deinen Namen ein."},languages:{language_search:"Sprachsuche",language_name:"Language Name",iso_code:"ISO code",not_found_in_db:"wurde nicht gefunden",specify_search_request_at_least_3_chars:"Bitte sei etwas genauer.\nGib mindestens 3 Zeichen ins Suchfeld ein.",primary_language:"Primärsprache",mother_tongue:"Muttersprache",additional_information:"Additional Information"},resources:{unknown:"Unbekannt",create_one_bundle_per_file:"Ein Bundle pro Datei erstellen",files:"Dateien",selected_files:"Ausgewählte Dateien",sort_alphabetically:"Alphabetisch sortieren",remove:"Entfernen",clear_file_list:"Dateiliste löschen",usage:"Benutzung",click:"Klick",click_to_select:"Datei wird ausgewählt, noch ein Klick macht die Auswahl rückgängig",shift:"Shift",shift_to_select_multiple:"Halte Shift, um mehrere Dateien auf einmal auszuwählen",escape:"Escape",escape_to_deselect:"Alle Dateien werden deselektiert",size:"Größe",path:"Pfad",last_modified:"Letzte Änderung",no_resource_files_imported:"Keine Dateien importiert.",fade:"Ausgeblendete Dateien",fade_explanation:"Dateien werden ausgeblendet, wenn sie in einem Bundle enthalten sein werden.<br>Dies soll das versehentliche Auswählen dieser verhindern.",set_for_all:"Für alle festlegen"},persons:{new_person:"Neue Person",delete_this_person:"Diese Person löschen",sort_persons_alphabetically:"Alphabetisch sortieren",persons_alphabetically_sorted:"Personen sortiert",duplicate_this_person:"Diese Person duplizieren",yes_delete_all_persons:"Ja, alle Personen löschen",no:"Nein",ok:"OK",confirm_erasing_persons_db:"Willst du wirklich alle Personen löschen?",all_persons_deleted:"Alle Personen gelöscht",there_are_no_persons:"Es existieren keine Personen!",persons_imported:"Personen importiert",give_your_person_a_name_first:"Bitte gib der Person zuerst einen Namen.",yes_delete_person:"Ja, Person löschen",really_erase_before_name:"Willst du wirklich ",really_erase_after_name:" löschen?",person_deleted_before_name:"",person_deleted_after_name:" gelöscht",there_are_no_persons_yet:"Es existieren noch keine Personen.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eine?",please_give_all_persons_a_name_before_creating_new_one:"Bitte gib allen Personen einen Namen, bevor du eine neue erstellst!",really_erase_this_person:"Willst du diese Person wirklich löschen?",unnamed_person:"Unbenannte Person"},bundle:{new_bundle:"Neues Bundle",copy_bundle_1_metadata:"Dupliziere Bundle-1-Metadaten in allen Bundles",reset_form:"Formular zurücksetzen",sort_by_name:"Nach Namen sortieren",add_to_bundle:"Hinzufügen",no_files_have_been_added:"Es wurden noch keine Dateien importiert.",add_some_files:"Importiere welche.",new_bundle_has_been_created:"Ein neues Bundle wurde erstellt.",name:"Name",unnamed_bundle:"Unbenanntes Bundle",bundle:"Bundle",delete_bundle:"Bundle löschen",expand_bundle:"Bundle ausklappen",collapse_bundle:"Bundle minimieren",expand_collapse_bundle:"Bundle ausklappen/minimieren",no_persons_created_yet:"Es wurden noch keine Personen erstellt.",create_some_persons:"Erstelle welche.",really_erase_bundle:"Willst du wirklich ein komplettes Bundle löschen?",yes_delete_bundle:"Ja, Bundle löschen",bundle_deleted:"Bundle gelöscht",no_bundles_have_been_created_yet:"Es wurden noch keine Bundles erstellt.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eins?",this_person_is_already_in_the_bundle:"Diese Person wurde bereits zum Bundle hinzugefügt.",bundle_name_taken_from_eaf:"Der Bundle-Name wurde vom Dateinamen der EAF-Datei übernommen, da die Session noch keinen Namen hatte.",bundle_date_extracted_from_eaf_file_name:"Das Datum des Bundles wurde aus dem Dateinamen der EAF-Datei extrahiert.",at_least_2_bundles_to_assign_metadata:"Es muss mindestens 2 Bundles geben, damit von einer Session in die andere kopiert werden können.",bundle_1_metadata_assigned_to_all_bundles:"Die Metadaten von Bundle 1 wurden in allen Sessions dupliziert.",this_function_is_currently_unavailable:"Diese Funktion ist zur Zeit nicht verfügbar!",no:"Nein",yes_delete_form:"Ja, Formular zurücksetzen",really_reset_form:"Willst du das Formular wirklich zurücksetzen und alle Bundles löschen?",form_reset:"Formular zurückgesetzt",specify_local_used_language_name:"Gib den lokal benutzten Sprachnamen ein",subject_language:"Subject Language",content_language:"Content Language",working_language:"Working Language",object:"Object",file_name:"Dateiname",copy_metadata:"Metadaten kopieren",from_bundle_1_to_all_others:"Von Bundle 1 in alle anderen Bundles",from_2nd_last_to_last_bundle:"Vom vorletzten Bundle ins letzte Bundle",elements_to_copy:"Zu kopierende Elemente",from_where_to_where:"Von wo nach wo",metadata_copied:"Metadaten kopiert"},output:{bundles_must_have_proper_name:"Jedes Bundle muss einen validen Namen haben!",you_must_create_some_bundles_first:"Du musst zuerst Bundles erstellen!",download_corpus_including_all_bundles:"Corpus mit allen Bundles herunterladen",download_zip_archive:"ZIP-Archiv herunterladen",not_allowed_chars_are:"Nicht erlaubte Zeichen sind: ",spaces_are_not_allowed_either:"Leerzeichen sind auch nicht erlaubt.",bundles_must_have_one_language:"Jedes Bundle muss mindestens eine Language haben.",persons_must_have_valid_birth_year:"Jede Person muss ein valides Birth Year haben!",download_zip_archive:"ZIP-Archiv herunterladen"},really_overwrite_data:"Möchtest Du wirklich Daten überschreiben?",yes_overwrite_data:"Ja, Daten überschreiben"},eldp_environment.bundle_form={title:"eldp-form",type:"form",fields:[{title:"Bundle",name:"bundle",type:"column",fields:[{heading:"Title",name:"title",type:"text",comment:"An informative title, without abbreviations, given to the Project, Bundle or resource."},{heading:"ID",name:"id_element",type:"text",comment:"A unique identifier."},{heading:"Date",name:"date",type:"date",comment:"In general the primary date of the bundle is audio or video date. If this bundle is about written resources only it indicates the creation date of the primary document."},{heading:"Description",name:"description",type:"textarea",comment:"Here a relevant description referring to the bundle as a whole can be given. Example: A conversation of mother, father and child at the breakfast table."},{heading:"Additional Information of Bundle",name:"additional_information",type:"textarea"},{heading:"Location",name:"location",type:"subarea",fields:[{heading:"Name",name:"name",type:"text",comment:""},{heading:"Continent",name:"continent",type:"select",size:1,vocabulary:["Unknown","Unspecified","Africa","Asia","Europe","Australia","Oceania","North-America","Middle-America","South-America"],default_value:"Unspecified",comment:'If the document is about "the languages of South-America", only Continent is supposed to be specified.'},{heading:"Country",name:"country",type:"text",comment:""},{heading:"Region",name:"region",type:"text",comment:"This element can also be used to describe sub-regions. Examples: europe, the netherlands, gelderland, achterhoek."}]}]},{title:"Content",name:"content",type:"column",comment:"The content group is used to describe the content of the bundle. This is done using four dimensions (communication context, genre, task and modalities).",fields:[{heading:"Genre",name:"genre",type:"open_vocabulary",size:1,vocabulary:["Unknown","Unspecified","Conversation","Description","Dictionary","Discourse","Elicitation","Explanation","Folktale","Historical narrative","Interview","Metadata","Narrative","Procedural narrative","Questionnaire","Ritual/religious","Song","Speech","Stimuli","Wordlist"],comment:"The conventionalized discourse types of the content of the bundle."},{heading:"Keywords",type:"textarea",name:"keywords"},{heading:"Recording Equipment",name:"recording_equipment",type:"textarea"},{heading:"Recording Conditions",name:"recording_conditions",type:"textarea"}]},{title:"Languages",name:"languages",type:"column",fields:[{name:"bundle_languages",type:"special",object_structure:"array"}]},{title:"Persons",type:"column",name:"persons",fields:[{type:"special",name:"persons",object_structure:"array"}]},{title:"Objects",name:"resources",type:"column",fields:[{type:"special",name:"resources",object_structure:"array"},{heading:"Restrictions of Access",type:"textarea",name:"access_restrictions"},{heading:"Conditions of Access",type:"textarea",name:"access_conditions"}]}],fields_to_copy:[{name:"date",label:"Date",fields:["bundle_date"]},{name:"location",label:"Location",fields:["bundle_location"]},{name:"content",label:"Content",fields:["content"]},{name:"persons",label:"Persons",fields:["persons_description"]},{name:"languages",label:"Languages",fields:[]},{name:"restrictions_conditions_of_access",label:"Restrictions/Conditions Of Access",fields:["resources_access_restrictions","resources_access_conditions"]}]},eldp_environment.person_form={title:"eldp-actors",type:"form",fields:[{type:"column",fields:[{heading:"Title",name:"title",type:"text"},{heading:"Name (known as)",name:"nameKnownAs",type:"text"},{heading:"Name (Full Name)",name:"fullName",type:"text"},{heading:"Name (Sort By)",name:"nameSortBy",type:"text"},{heading:"Code",name:"code",type:"text",comment:"Short unique code to identify the actor as used in the transcription"},{heading:"Birth Year",name:"birth_year",type:"year"},{heading:"Death Year",name:"death_year",type:"year"},{heading:"Sex",name:"sex",type:"select",vocabulary:["Unknown","Unspecified","Female","Male"],default_value:"Unspecified"}]},{title:"",name:"",type:"column",fields:[{heading:"Ethnicities",name:"ethnicity",type:"textarea"},{heading:"Additional Information (Ethnicity)",name:"ethnicity_additional_info",type:"textarea"},{heading:"Nationalities",name:"nationality",type:"textarea"},{heading:"Additional Information (Nationality)",name:"nationality_additional_info",type:"textarea"}]},{type:"column",fields:[{heading:"Education",name:"education",type:"text"},{heading:"Biographical Note",name:"biographical_note",type:"textarea"},{heading:"Additional Information (Person)",name:"person_additional_information",type:"textarea"},{heading:"Anonymized",name:"anonymized",type:"check",comment:"Indicates if real names or anonymized codes are used to identify the actor"}]},{title:"Languages",name:"languages",type:"column",fields:[{heading:"Actor Languages",name:"actor_languages",type:"special",object_structure:"array"}]}]},eldp_environment.workflow[0]=function(){"use strict";var e,n={};return n.parent=eldp_environment,n.l=n.parent.l,n.fileSelection=void 0,n.resources=new ObjectList,n.identity={id:"resources",title:"Resources",icon:"blocks"},n.view_id="VIEW_resources",n.substitute_for_bad_chars="_",n.init=function(t){e=eldp_environment.workflow[2];var r=dom.make("div","files","",t);dom.h3(r,"Import Files");APP.GUI.FORMS.fileDropZone(r,"drop_zone",n.pushFileMetadata);dom.h3(r,"Import File List");var a=dom.input(r,"file_list_import_input","","","file");a.addEventListener("change",n.handleFileListInputChange,!1);{var o=(dom.make("div","","workspace-usageTable",r,"<h3>"+n.l("resources","usage")+"</h3><h4>"+n.l("resources","click")+"</h4><p>"+n.l("resources","click_to_select")+"</p><h4>"+n.l("resources","shift")+"</h4><p>"+n.l("resources","shift_to_select_multiple")+"</p><h4>"+n.l("resources","escape")+"</h4><p>"+n.l("resources","escape_to_deselect")+"</p><h4>"+n.l("resources","fade")+"</h4><p>"+n.l("resources","fade_explanation")+"</p>"),dom.make("div","file_list_div","",t));dom.make("div","list","",o)}n.fileSelection=new APP.GUI.selectionMechanism("file_entry_","selected_file",function(e){n.resources.get(e.index).selected=e.selected,n.fadeFilesThatStartWithSameNameAsSelectedOnes()}),n.refresh(!0)},n.view=function(){APP.GUI.scrollTop()},n.getFileType=function(e){var t=n.file_types,r=e.lastIndexOf("."),o=e.slice(r+1),s={type:n.l("resources","unknown"),mimetype:n.l("resources","unknown")},i=a(t.valid_lamus_written_resource_file_types,0),l=i.indexOf(o);return-1!=i.indexOf(o)?(s.type=t.valid_lamus_written_resource_file_types[l][2],s.mimetype=t.valid_lamus_written_resource_file_types[l][1],s):(i=a(t.valid_lamus_media_file_types,0),l=i.indexOf(o),-1!=i.indexOf(o)?(s.type=t.valid_lamus_media_file_types[l][2],s.mimetype=t.valid_lamus_media_file_types[l][1],s):(i=a(t.invalid_lamus_media_file_types,0),l=i.indexOf(o),-1!=l?(s.type=t.invalid_lamus_media_file_types[l][2],s.mimetype=t.invalid_lamus_media_file_types[l][1],s):(i=a(t.invalid_lamus_written_resource_file_types,0),l=i.indexOf(o),-1!=l?(s.type=t.invalid_lamus_written_resource_file_types[l][2],s.mimetype=t.invalid_lamus_written_resource_file_types[l][1],s):s)))},n.file_types={valid_lamus_written_resource_file_types:[["eaf","text/x-eaf+xml","Annotation"],["mdf","Unknown","Unspecified"],["pdf","application/pdf","Primary Text"],["xml","text/xml","Annotation"],["txt","text/plain","Unspecified"],["htm","text/html","Unspecified"],["html","text/html","Unspecified"]],valid_lamus_media_file_types:[["wav","audio/x-wav","audio"],["mpg","video/mpeg","video"],["mpeg","video/mpeg","video"],["mp4","video/mp4","video"],["aif","audio/x-aiff","audio"],["aiff","audio/x-aiff","audio"],["jpg","image/jpeg","image"],["jpeg","image/jpeg","image"],["png","image/png","image"],["tif","image/tiff","image"],["tiff","image/tiff","image"],["smil","application/smil+xml","video"]],invalid_lamus_written_resource_file_types:[["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document","Unspecified"],["doc","application/msword","Unspecified"],["odf","application/vnd.oasis.opendocument.formula","Unspecified"],["odt","application/vnd.oasis.opendocument.text","Unspecified"],["xls","application/vnd.ms-excel","Unspecified"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Unspecified"],["ppt","application/vnd.ms-powerpoint","Unspecified"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation","Unspecified"]],invalid_lamus_media_file_types:[["mkv","Unknown","video"],["mov","video/quicktime","video"],["mp3","Unknown","audio"],["avi","video/x-msvideo","video"],["au","audio/basic","audio"]]},n.recall=function(e){n.resources.setState(e),n.refresh()},n.getSaveData=function(){return n.resources.getState()},n.functions=function(){return[{label:n.l("resources","create_one_bundle_per_file"),icon:"plus",id:"crps_icon",wrapper_id:"crps_div",type:"function_wrap",sub_div:"crps_filetype_select",onclick:function(){n.createBundlePerResource(),APP.view(e)},sub_div_innerHTML:'<h3 class="inner_function_h3">'+n.l("resources","files")+'</h3><input type="radio" name="radio_file_type" value="selected" checked> '+n.l("resources","selected_files")+'<br><input type="radio" name="radio_file_type" value="eaf"> EAF<br><input type="radio" name="radio_file_type" value="wav"> WAV<br><input type="radio" name="radio_file_type" value="mpg"> MPG<br><input type="radio" name="radio_file_type" value="mp4"> MP4<br>'},{id:"link_sort_alphabetically",icon:"az",label:n.l("resources","sort_alphabetically"),onclick:function(){n.sortAlphabetically()}},{id:"link_remove_files",icon:"reset",label:n.l("resources","remove"),onclick:function(){n.removeSelectedFiles()}},{id:"link_clear_file_list",icon:"reset",label:n.l("resources","clear_file_list"),onclick:function(){n.reset()}},{id:"link_set_for_all",icon:"submit",label:n.l("resources","set_for_all"),wrapper_id:"sfa_div",type:"function_wrap",sub_div:"sfa_select",onclick:function(){n.setForAll()},sub_div_innerHTML:'<input type="radio" name="status_for_all" id="stable_for_all" value="stable" checked> Stable<br><input type="radio" name="status_for_all" id="inProgress_for_all" value="in-progress"> In Progress<br>'}]},n.setForAll=function(){console.log(dom.getSelectedRadioValue("status_for_all")),n.resources.setForAll("status",dom.getSelectedRadioValue("status_for_all")),n.refresh()},n.getValidityOfFile=function(e){var t,r=strings.getFileTypeFromFilename(e);for(t=0;t<n.file_types.valid_lamus_media_file_types.length;t++)if(r==n.file_types.valid_lamus_media_file_types[t][0])return 0;for(t=0;t<n.file_types.valid_lamus_written_resource_file_types.length;t++)if(r==n.file_types.valid_lamus_written_resource_file_types[t][0])return 1;for(t=0;t<n.file_types.invalid_lamus_media_file_types.length;t++)if(r==n.file_types.invalid_lamus_media_file_types[t][0])return 2;for(t=0;t<n.file_types.invalid_lamus_written_resource_file_types.length;t++)if(r==n.file_types.invalid_lamus_written_resource_file_types[t][0])return 3;return-1},n.refresh=function(t){var r=g("list");r.innerHTML="",n.resources.forEach(function(e,t){n.renderResource({number:t,title:e.name,mime_type:e.mime_type,file_size:e.size,lastModified:e.lastModified,id:"file_entry_"+t,className:"file_entry media_file_entry",parent:r,status:e.status,path:e.path})}),0===n.resources.length&&(r.innerHTML="<h2>"+n.l("resources","no_resource_files_imported")+"</h2>"),e&&!t&&e.refresh(),n.fileSelection.selected_files=[]},n.refreshFileStateValues=function(e){n.resources.get(e).status=dom.getSelectedRadioValue("f_"+e+"_status")},n.renderResource=function(e){{var t=dom.make("div",e.id,e.className,e.parent),r=(dom.make("h2","","file_entry_title",t,e.title),dom.make("p","","",t,e.mimeType+'<br><span class="size_span">'+n.l("resources","size")+": "+e.file_size+'</span><br><span name="date_span" class="date_span">'+n.l("resources","last_modified")+": "+e.lastModified+'</span><br><span name="path_span" class="date_span">'+n.l("resources","path")+": "+e.path+"</span>"),[{title:"Stable",value:"stable"},{title:"In Progress",value:"in-progress"}]);dom.makeRadios(t,r,"f_"+e.number+"_status","f_"+e.number+"_status_","title","value",e.status,function(){n.refreshFileStateValues(e.number)})}t.addEventListener("click",function(e){return function(){n.fileSelection.clickedOnFile(e)}}(e.number),!1)},n.pushFileMetadata=function(e){for(var t,r=0;t=e[r];r++)n.resources.add({name:t.name,type:t.type||"n/a",size:strings.bytesToSize(t.size,1),lastModified:t.lastModifiedDate.toLocaleDateString(),status:"stable"});n.refresh()},n.sortAlphabetically=function(){n.resources.sortByKey("name"),n.refresh()},n.createBundlePerResource=function(){var e,t=dom.getByName("radio_file_type"),r=dom.getSelectedRadioValue(t);if(console.log("Searching for files of chosen file type "+r),"selected"!=r)for(e=0;e<n.resources.length;e++){var a=strings.getFileTypeFromFilename(n.resources.get(e).name);a==r&&(console.log("Found a file of file type "+r),n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(n.resources.idOf(e)))}else for(console.log("Searching for selected files"),e=0;e<n.fileSelection.selected_files.length;e++){var o=n.resources.idOf(n.fileSelection.selected_files[e]);n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(o)}},n.removeSelectedFiles=function(){var e=n.fileSelection.selected_files,t=n.resources.mapIndexesToIDs(e);n.resources.removeByID(t),n.refresh()},n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd=function(t){var r=strings.replaceAccentBearingLettersWithASCISubstitute(strings.removeEndingFromFilename(n.resources.getByID(t).name));r=strings.replaceCharactersInStringWithSubstitute(r,n.parent.not_allowed_chars,n.substitute_for_bad_chars);var a=!1,o=[];o.push(t);var s=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(t);o.push.apply(o,s),e.createNewBundleWithResources(r,a,o)},n.getIDsOfResourcesThatStartWithTheSameNameAsThis=function(e){var t=n.resources.getByID(e),r=n.resources.filter(function(n){return e==n.id?!1:strings.isSubstringAStartOfAWordInString(strings.removeEndingFromFilename(n.name),strings.removeEndingFromFilename(t.name))?!0:!1}),a=getArrayWithIDs(r);return a},n.fadeFilesThatStartWithSameNameAsSelectedOnes=function(){for(var e,t="file_entry_",r=[],a=0;a<n.resources.length;a++)g(t+a.toString()).style.opacity="1";for(var o=0;o<n.fileSelection.selected_files.length;o++){var s=n.fileSelection.selected_files[o],i=n.resources.idOf(s);r.push(i);var l=n.resources.idOf(s);e=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(l);for(var d=0;d<e.length;d++)r.push(e[d])}for(a=0;a<r.length;a++){var _=n.resources.indexOf(r[a]);g(t+_.toString()).style.opacity="0.5"}},n.handleFileListInputChange=function(e){var t,r=e.target.files[0];readFileAsText(r,function(e){try{t=strings.linesToArray(e)}catch(r){return void console.info("No files found! Maybe this file list is not valid!")}forEach(t,function(e){e.length>0&&" "!=e&&n.resources.add({name:strings.getFilenameFromFilePath(e),path:strings.getDirectoryFromFilePath(e),status:"stable"})}),n.refresh()})},n.reset=function(){n.resources.reset(),n.refresh()},n}(),eldp_environment.workflow[1]=function(){"use strict";var e=function(){forEach(o.persons.getActive().languages.actor_languages,o.languages.set)},n=function(){var e=o.languages.languages_of_active_person.map(function(e){return"LOCAL"==e.name_type&&(e.name=get("person_languages_"+e.id+"_name_input")),e.additional_information=get("person_languages_"+e.id+"addInfo"),e});return e},t=function(){var e=APP.forms.createEmptyObjectFromTemplate(d);return APP.forms.fillObjectWithFormData(e,o.element_id_prefix,d),e.languages.actor_languages=n(),e},r=function(e){o.saveActivePerson("without_refreshing"),o.show(o.persons.idOf(e))},a=function(){return!o.persons.isThereAnyItemWhereKeyIsValue("name","")},o={};o.parent=eldp_environment;var s,l=function(e,n){return o.parent.l("persons",e,n)},d=o.parent.person_form;return o.persons=new ObjectList,o.element_id_prefix="person_",o.identity={id:"persons",title:"Persons",icon:"user"},o.module_view,o.init=function(e){o.persons.reset(),o.module_view=e,s=o.parent.workflow[2],o.gui_list=new APP.GUI.FORMS.clickableListSmall(e,[],[],r,o.element_id_prefix+"list",0);
dom.make("div",o.element_id_prefix+"view","",e);o.languages.init(),o.refresh(!0)},o.getSaveData=function(){var e={};return o.saveActivePerson(),e.persons=o.persons.getState(),e},o.showNoPersonsMessage=function(){var e=o.module_view;e.innerHTML="";var n=dom.make("h2","no_persons_text","no_persons_text",e);n.innerHTML=l("there_are_no_persons_yet")+" "+l("why_not_create_one__before_link");var t=dom.make("a","new_person_link","new_person_link",n);t.innerHTML=l("why_not_create_one__link"),n.innerHTML+=l("why_not_create_one__after_link"),g("new_person_link").addEventListener("click",function(){o.createNewPerson()})},o.recall=function(e){e.persons&&o.persons.setState(e.persons),o.refresh(),o.show(o.persons.getPointer())},o.functions=function(){return[{id:"link_new_person",icon:"plus",label:l("new_person"),onclick:function(){o.createNewPerson()}},{id:"link_delete_active_person",icon:"reset",label:l("delete_this_person"),onclick:function(){o.handleClickOnDeletePerson()}},{id:"link_sort_persons_alphabetically",icon:"az",label:l("sort_persons_alphabetically"),type:"function_wrap",wrapper_id:"sa_div",sub_div:"sa_subdiv",sub_div_innerHTML:'<input type="radio" name="sa_by" value="nameKnownAs"> By Name (known as)<br><input type="radio" name="sa_by" value="fullName" checked> By Full Name<br><input type="radio" name="sa_by" value="nameSortBy"> By Name (Sort By)',onclick:function(){o.saveActivePerson();var e=dom.getSelectedRadioValue(dom.getByName("sa_by"));o.persons.sortByKey(e),o.refresh(),APP.log(l("persons_alphabetically_sorted"))}},{id:"link_duplicateActivePerson",icon:"duplicate_user",label:l("duplicate_this_person"),onclick:function(){o.saveActivePerson(),o.persons.duplicateActive(),o.refresh(),APP.log(l("person_saved_and_duplicated"),"success")}}]},o.erase_database=function(){APP.confirm(l("confirm_erasing_persons_db"),function(e){e||(o.persons.reset(),APP.log(l("all_persons_deleted")),o.refresh())},l("no"),l("yes_delete_all_persons"))},o.show=function(n){if(0==o.persons.length)return void console.info("person.show: No persons to show!");var t=o.persons.getIndexByID(n);"undefined"==typeof t&&(console.warn("person.show: Undefined person_id! Showing person 0"),t=0),console.log("Showing person "+t),o.createFormIfNotExistent(),o.gui_list.changeHighlight(t),o.languages.clearActivePersonLanguages(),o.persons.setPointer(n),o.refreshFormTitle();var r=o.persons.getActive();APP.forms.fill(d,o.element_id_prefix,r),e()},o.refreshFormTitle=function(){var e=g(o.element_id_prefix+"form_title"),n=o.getDisplayName(o.persons.getActive());e.innerHTML=""==n?l("unnamed_person"):n},o.createFormIfNotExistent=function(){var e=g("person_view");if(!e){e=dom.make("div","person_view","person_view",o.module_view),e.innerHTML="";var n=dom.make("div",o.element_id_prefix+"title_div","",e);dom.make("h1",o.element_id_prefix+"form_title","",n,l("new_person")),dom.make("div",o.element_id_prefix+"content_div","",e),APP.forms.make(g(o.element_id_prefix+"content_div"),d,o.element_id_prefix,o.element_id_prefix,void 0,o.languages.makeInputInForm),g(o.element_id_prefix+"nameKnownAs").addEventListener("blur",o.saveActivePerson),g(o.element_id_prefix+"fullName").addEventListener("blur",o.saveActivePerson),g(o.element_id_prefix+"nameSortBy").addEventListener("blur",o.saveActivePerson)}},o.saveActivePerson=function(e){if(-1!=o.persons.getPointer()){var n=t();return n.display_name=o.getDisplayName(n),o.save(n),"without_refreshing"!=e&&(o.refresh(),o.refreshFormTitle()),n}},o.save=function(e){return o.persons.replaceActive(e),s.updatePersonNameInAllBundles(e.id),e},o.createNewPerson=function(e){if(o.saveActivePerson(),!a())return void APP.alert(l("please_give_all_persons_a_name_before_creating_new_one"));e||(e=APP.forms.createEmptyObjectFromTemplate(d)),e.display_name=o.getDisplayName(e);var n=o.persons.add(e);o.createFormIfNotExistent(),o.refresh(),o.show(n)},o.handleClickOnDeletePerson=function(){if(-1==typeof o.persons.pointer)return void console.warn("Active Person is undefined. Don't know what to delete!");var e,n=o.persons.getActive().name;e=""==n?l("really_erase_this_person"):l("really_erase_before_name")+n+l("really_erase_after_name"),APP.confirm(e,function(e){e||(o.deleteActivePerson(),APP.log(l("person_deleted_before_name")+n+l("person_deleted_after_name")))},l("no"),l("yes_delete_person"))},o.deleteActivePerson=function(){o.persons.removeActive(),o.refresh()},o.getAge=function(e,n){var t=o.persons.getByID(n);if(""===t.age){if(g("radio_age_calc").on){var r=t.birth_date.year+"-"+t.birth_date.month+"-"+o.persons[i].birth_date.day,a=get(s.dom_element_prefix+e+"_bundle_date_year")+"-"+get(s.dom_element_prefix+e+"_bundle_date_month")+"-"+get(s.dom_element_prefix+e+"_bundle_date_day"),l=calcAgeAtDate(a,r);return 0!==l?(console.info("person's age successfully calculated"),l):"Unspecified"}return"Unspecified"}return t.age},o.refresh=function(e){o.module_view.innerHTML="";var n=o.persons.map(function(e){return o.getDisplayName(e.id)});o.gui_list.refresh(n),0==o.persons.length?(o.showNoPersonsMessage(),APP.environments.disableFunction("link_delete_active_person"),APP.environments.disableFunction("sa_div"),APP.environments.disableFunction("link_duplicateActivePerson")):(o.createFormIfNotExistent(),o.show(o.persons.getActiveIndex()),o.gui_list.changeHighlight(o.persons.getActiveIndex()),APP.environments.enableFunction("link_delete_active_person"),APP.environments.enableFunction("sa_div"),APP.environments.enableFunction("link_duplicateActivePerson")),s&&!e&&s.refreshPersonLists(o.persons.getAll())},o.getDisplayName=function(e){var n;return"object"==typeof e?n=e:o.persons.existsByID(e)&&(n=o.persons.getByID(e)),n?n.fullName&&""!=n.fullName?n.fullName:n.nameSortBy&&""!=n.nameSortBy?n.nameSortBy:n.nameKnownAs&&""!=n.nameKnownAs?n.nameKnownAs:l("unnamed_person"):console.warn("Person undefined!")},o.doesEveryPersonHaveValidBirthYear=function(){for(var e=0;e<o.persons.length;e++){var n=o.persons.get(e).birth_year;if(n.length>4||"YYYY"==n||""==n)return!1}return!0},o.doesEveryPersonHaveALanguage=function(){for(var e=0;e<o.persons.length;e++)if(0==o.persons.get(e).languages.actor_languages.length)return!1;return!0},o}(),eldp_environment.workflow[1].languages=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.workflow[1];return e.languages_of_active_person=new ObjectList,e.element_id_prefix=n.element_id_prefix+"languages_",e.l=e.parent.l,e.init=function(){},e.makeInputInForm=function(n,t,r){"actor_languages"==n.name&&APP.GUI.makeLanguageSearchForm(t,r,!1,!1,e.addFromForm)},e.remove=function(n){e.languages_of_active_person.removeByID(n),dom.remove(e.element_id_prefix+n+"_div")},e.clearActivePersonLanguages=function(){e.languages_of_active_person.reset(),g(e.element_id_prefix+"display").innerHTML=""},e.set=function(n){e.languages_of_active_person.add(n),e.renderActorLanguage(g(e.element_id_prefix+"display"),n)},e.renderActorLanguage=function(t,r){var a=dom.make("div",e.element_id_prefix+r.id+"_div",e.element_id_prefix+"entry",t);if(APP.GUI.icon(a,"delete_lang_"+r.id+"_icon","delete_lang_icon","reset",function(e){return function(){n.languages.remove(e)}}(r.id)),dom.spanBR(a,"","","ISO639-3 Code: "+r.iso_code),dom.span(a,"","","Name: "),"LOCAL"==r.name_type){var o=""!==r.name?r.name:e.l("bundle","specify_local_used_language_name");dom.textInput(a,e.element_id_prefix+r.id+"_name_input","eldp_person_lang_name_input","",o)}else dom.span(a,"","",r.name);dom.br(a),dom.spanBR(a,"","","Country ID: "+r.country_code),dom.br(a),APP.GUI.makeTextarea(18,4,a,e.l("languages","additional_information"),e.element_id_prefix+r.id+"addInfo",e.element_id_prefix+r.id+"addInfo","className",r.additional_information,"")},e.addFromForm=function(n){console.log(n);var t;t=0===e.languages_of_active_person.length?!0:!1;var r={iso_code:n[0],name:n[3],country_code:n[1],name_type:n[2],additional_information:""};e.set(r)},e}(),eldp_environment.workflow[2]=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.bundle_form;e.refresh=function(){e.render.refresh(e.bundles.getAll())},e.identity={id:"bundle",title:"Bundles",icon:"edit"},e.bundles=new ObjectList,e.lang_id_counter=0,e.resource_id_counter=0,e.person_id_counter=0,e.dom_element_prefix="bundle_",e.reset=function(){e.bundles.eraseAll(),e.refresh()};var t,r,a=e.parent.l;return e.init=function(n){t=eldp_environment.workflow[0],r=eldp_environment.workflow[1],e.bundles.reset(),e.resource_id_counter=0,e.person_id_counter=0;var a={newBundle:e.newBundle,deleteBundle:e.userErase,setLanguage:e.set,addPerson:e.addPerson,removePerson:e.removePerson,addResource:e.addResource,removeResource:e.removeResource,removeResourceAndRefresh:e.removeResourceAndRefresh,removeLanguage:e.removeLanguage};e.render.init(n,a)},e.view=function(){e.render.view()},e.recall=function(n){n.bundles&&(e.bundles.setState(n.bundles),n.person_id_counter&&(e.person_id_counter=n.person_id_counter),e.refresh())},e.getSaveData=function(){e.refreshVisibleBundlesInArray();var n={bundles:e.bundles.getState(),lang_id_counter:e.lang_id_counter,person_id_counter:e.person_id_counter};return n},e.refreshVisibleBundlesInArray=function(){forEach(e.render.pager.visible_items,e.refreshBundleInArray)},e.refreshBundleInArray=function(t){var r=t;APP.forms.fillObjectWithFormData(r,e.dom_element_prefix+t.id+"_",n),forEach(r.persons.persons,function(e){e.role=get("person_in_bundle_"+e.id+"_role_input")}),forEach(r.resources.resources,function(n){n.urcs.u=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_u").checked,n.urcs.r=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_r").checked,n.urcs.c=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_c").checked,n.urcs.s=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_s").checked}),forEach(r.languages.bundle_languages,function(n){n.content_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_content_language").checked,n.working_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_working_language").checked,"LOCAL"==n.name_type&&(n.name=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_name_input").value)})},e.functions=function(){return[{label:a("bundle","new_bundle"),icon:"plus",id:"link_newBundle",onclick:function(){e.newBundle()}},{label:a("bundle","copy_metadata"),icon:"copy",id:"link_copy_bundles",wrapper_id:"copy_bundles_div",type:"function_wrap",sub_div:"copy_bundles_select",onclick:function(){e.handleClickOnCopyMetadata()},after_that:e.render.createCopyBundleOptions},{label:a("bundle","sort_by_name"),icon:"az",id:"bundle_link_sort_by_name",onclick:function(){e.refreshVisibleBundlesInArray(),e.bundles.sortBySubKey("bundle","name"),e.refresh()}}]},e.newBundle=function(){var n=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);return n.expanded=!0,e.bundles.add(n),e.refresh(),n.id},e.createNewBundleWithResources=function(n,t,r){var o=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);o.bundle.name=n,o.expanded=t,e.bundles.add(o),e.render.renderBundle(o);for(var s=0;s<r.length;s++)e.addResource(o.id,r[s]);return APP.log(a("bundle","new_bundle_has_been_created")+"<br>"+a("bundle","name")+": "+n),o.id},e.set=function(n,t,r){var a={code:n[0],name:n[3],name_type:n[2],country_code:n[1],id:e.lang_id_counter,working_language:!1,content_language:!1};e.bundles.getByID(t).languages.bundle_languages.push(a),e.render.renderLanguage(a,t,r),e.lang_id_counter+=1},e.removeLanguage=function(n,t,r){var a=e.bundles.getIndexByID(n),o=e.getLanguageObjectIndexByID(a,t);e.bundles.get(a).languages.bundle_languages.splice(o,1),dom.remove(r)},e.getLanguageObjectIndexByID=function(n,t){return getIndex(e.bundles.get(n).languages.bundle_languages,4,t)},e.getName=function(n){return""===e.bundles.get(n).name?a("bundle","unnamed_bundle"):a("bundle","bundle")+": "+e.bundles.get(n).name},e.userErase=function(n){APP.confirm(a("bundle","really_erase_bundle"),function(t){t||(e.bundles.eraseByID(n),APP.log(a("bundle","bundle_deleted")),e.refresh())},a("bundle","no"),a("bundle","yes_delete_bundle"))},e.getIndexFromResourceID=function(n){for(var t,r=0;r<e.bundles.length;r++){var a=e.bundles.get(r);for(t=0;t<a.resources.resources.length;t++)if(a.resources.resources[t].id==n)return t}},e.addPerson=function(n,t,a){if(!r.persons.getByID(t))return void console.log("Tried to add person to bundle although this person is not in the persons database. This is odd.");e.refreshVisibleBundlesInArray(),console.log("adding person in bundle with id "+n),"string"!=typeof a&&(a="");var o={id:e.person_id_counter,person_id:t,role:a};e.bundles.getByID(n).persons.persons.push(o),e.refresh(),e.person_id_counter=e.person_id_counter+1},e.removePerson=function(n,t){var r=e.bundles.getByID(n),a=r.persons.persons,o=getIndexByID(a,t);a.splice(o,1),dom.remove(e.dom_element_prefix+n+"_person_"+t)},e.addResource=function(n,r){if(!(r>=t.resources.length)){var a=t.resources.get(r),o=e.resource_id_counter,s={u:!1,r:!1,c:!1,s:!1},i={id:o,resource_id:a.id,urcs:s};if(e.bundles.getByID(n).resources.resources.push(i),"eaf"==strings.getFileTypeFromFilename(a.name)&&""===get(e.dom_element_prefix+n+"_bundle_title")){var l=strings.removeEndingFromFilename(a.name);e.bundles.getByID(n).bundle.title=l}return e.refresh(),e.resource_id_counter+=1,o}},e.removeResourceAndRefresh=function(n,t){e.refreshResource(n,t),e.refresh()},e.removeResource=function(n,t){console.log("SHALL REMOVE RES. bun_id="+n+", RES_IN_BUN_ID = "+t);var r=getArrayWithIDs(e.bundles.getByID(n).resources.resources);if(-1!=r.indexOf(t)){var a=e.getIndexFromResourceID(t);e.bundles.getByID(n).resources.resources.splice(a,1)}},e.handleClickOnCopyMetadata=function(){e.refreshVisibleBundlesInArray(),"1_to_others"==get("copy_bundle_options")?e.assignBundle1Metadata():e.copyMetadataFrom2ndLastToLast(),e.refresh()},e.copyMetadataFrom2ndLastToLast=function(){if(e.bundles.length<2)return void APP.log(a("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){var r=e.bundles.getLast(),o=e.bundles.getFromEnd(1);"persons"==n.fields_to_copy[t].name&&(e.removeAllPersons(r.id),forEach(o.persons.persons,function(n){e.addPerson(r.id,n.person_id,n.role)})),"languages"==n.fields_to_copy[t].name&&(r.languages.bundle_languages=[],forEach(o.languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,r.languages.bundle_languages.push(t)})),e.copyFieldsFrom2ndLastToLastBundle(n.fields_to_copy[t].fields)}APP.log(a("bundle","metadata_copied"))},e.assignBundle1Metadata=function(){if(e.bundles.length<2)return void APP.log(a("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){if("persons"==n.fields_to_copy[t].name)for(var r=1;r<e.bundles.length;r++)e.removeAllPersons(e.bundles.idOf(r)),forEach(e.bundles.get(0).persons.persons,function(n){e.addPerson(e.bundles.idOf(r),n.person_id,n.role)});if("languages"==n.fields_to_copy[t].name)for(r=1;r<e.bundles.length;r++)e.bundles.get(r).languages.bundle_languages=[],forEach(e.bundles.get(0).languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,e.bundles.get(r).languages.bundle_languages.push(t)});e.copyFieldsToAllBundles(n.fields_to_copy[t].fields)}APP.log(a("bundle","bundle_1_metadata_assigned_to_all_bundles"))},e.copyFieldsToAllBundles=function(n){for(var t=1;t<e.bundles.length;t++)for(var r=0;r<n.length;r++)"bundle_date"==n[r]&&(e.bundles.get(t).bundle.date=cloneObject(e.bundles.getFirst().bundle.date)),"bundle_location"==n[r]&&(e.bundles.get(t).bundle.location=cloneObject(e.bundles.getFirst().bundle.location)),"content"==n[r]&&(e.bundles.get(t).content=cloneObject(e.bundles.getFirst().content)),"persons_description"==n[r]&&(e.bundles.get(t).persons.description=e.bundles.getFirst().persons.description),"resources_access_restrictions"==n[r]&&(e.bundles.get(t).resources.access_restrictions=e.bundles.getFirst().resources.access_restrictions),"resources_access_conditions"==n[r]&&(e.bundles.get(t).resources.access_conditions=e.bundles.getFirst().resources.access_conditions)},e.refreshPersonLists=function(n){e.render.refreshPersonLists(e.bundles.getAll(),n)},e.copyFieldsFrom2ndLastToLastBundle=function(n){for(var t=e.bundles.getLast(),r=e.bundles.getFromEnd(1),a=0;a<n.length;a++)"bundle_date"==n[a]&&(t.bundle.date=cloneObject(r.bundle.date)),"bundle_location"==n[a]&&(t.bundle.location=cloneObject(r.bundle.location)),"content"==n[a]&&(t.content=cloneObject(r.content)),"persons_description"==n[a]&&(t.persons.description=r.persons.description),"resources_access_restrictions"==n[a]&&(t.resources.access_restrictions=r.resources.access_restrictions),"resources_access_conditions"==n[a]&&(t.resources.access_conditions=r.resources.access_conditions)},e.removeAllPersons=function(n){e.bundles.getByID(n).persons.persons=[],e.refresh()},e.areAllBundlesProperlyNamed=function(){for(var n=0;n<e.bundles.length;n++)if(""===e.bundles.get(n).bundle.title)return!1;return!0},e.doAllBundlesHaveALanguage=function(){for(var n=0;n<e.bundles.length;n++)if(0==e.bundles.get(n).languages.bundle_languages.length)return!1;return!0},e.updatePersonNameInAllBundles=function(){e.refreshVisibleBundlesInArray(),e.refresh()},e}(),eldp_environment.workflow[2].render=function(){"use strict";var e={};e.parent=eldp_environment;var n,t,r,a,o=e.parent.l,s=e.parent.bundle_form;return e.dom_element_prefix="bundle_",e.init=function(o,s){e.view_element=o,r=s,n=eldp_environment.workflow[0],t=eldp_environment.workflow[1],a=eldp_environment.workflow[2],e.displayNoBundleText(r.newBundle);var i={render:e.renderBundle,on_page_change:e.refresh,items_list:a.bundles.getAll(),view:o,items_per_page:10,before_page_change:a.refreshVisibleBundlesInArray};e.pager=new APP.GUI.pager(i)},e.view=function(){APP.GUI.scrollTop(),e.pager.refresh(a.bundles.getAll())},e.createCopyBundleOptions=function(){var e=g("copy_bundles_select");dom.h3(e,o("bundle","from_where_to_where"));var n=[{title:o("bundle","from_bundle_1_to_all_others"),id:"1_to_others"},{title:o("bundle","from_2nd_last_to_last_bundle"),id:"second_last_to_last"}];if(dom.makeRadios(e,n,"copy_bundle_options","","title","id",0,void 0),dom.br(e),dom.h3(e,o("bundle","elements_to_copy")),!s.fields_to_copy)return void dom.make("span","","",e,o("bundle","this_function_is_currently_unavailable"));for(var t=s.fields_to_copy,r=0;r<t.length;r++){var a=dom.input(e,APP.CONF.copy_checkbox_element_prefix+t[r].name,"","","checkbox");a.checked=!0,dom.span(e,"",""," "+t[r].label),dom.br(e)}},e.refreshResources=function(t){var a=g(e.dom_element_prefix+t+"_resources_add_mf_div");a.innerHTML="";var s=document.createElement("select");if(dom.setSelectOptions(s,n.resources.getAll(),"name","take_index",!1),n.resources.length>0&&(a.appendChild(s),dom.br(a),dom.button(a,o("bundle","add_to_bundle"),function(e){return function(){r.addResource(e,s.selectedIndex,!1)}}(t))),0===n.resources.length){var i=document.createElement("h5");a.appendChild(i),i.innerHTML=o("bundle","no_files_have_been_added")+"<br>",dom.link(i,"","",o("bundle","add_some_files"),function(){APP.view(n)})}},e.refresh=function(n){var t=e.view_element;t.innerHTML="",e.pager.refresh(n),forEach(e.pager.visible_items,e.renderBundle),0===n.length&&e.displayNoBundleText(r.newBundle)},e.renderBundle=function(o){var i=o.id,l=o.expanded,d=e.view_element;g("no_bundle_text")&&(d.innerHTML="");var _=APP.GUI.FORMS.expandableForm(d,e.dom_element_prefix+i,l,function(e){o.expanded=e.expanded},r.deleteBundle,i);APP.forms.make(_.content,s,e.dom_element_prefix+i+"_",e.dom_element_prefix,o,e.makeSpecialFormInput),g(e.dom_element_prefix+i+"_bundle_title").addEventListener("blur",function(n){return function(){e.refreshBundleHeading(n)}}(i));var u=e.dom_element_prefix+i+"_languages_";forEach(o.languages.bundle_languages,function(n){e.renderLanguage(n,i,u)}),"undefined"!=typeof o.persons&&"undefined"!=typeof o.persons.persons&&forEach(o.persons.persons,function(n){e.renderPerson(o,n)}),"undefined"!=typeof o.resources.resources&&(forAllItems(o.resources.resources,function(e){n.resources.IDexists(e.resource_id)||(log("There is a resource in bundle "+o.id+" with resource_id "+e.resource_id+" that does not exist anymore. Deleting!"),r.removeResource(o.id,e.id))}),forEach(o.resources.resources,function(n){e.renderResource(n,i),n.id>=a.resource_id_counter&&(a.resource_id_counter=n.id+1)})),e.refreshResources(i);var c=t.persons.getArrayWithIDs();e.refreshPersonListInBundle(o,c),e.refreshBundleHeading(i)},e.makeSpecialFormInput=function(n,t,a){if("bundle_languages"==n.name){var o=a.slice(e.dom_element_prefix.length,a.indexOf("_",e.dom_element_prefix.length));APP.GUI.makeLanguageSearchForm(t,a,!1,!1,function(e){r.setLanguage(e,o,a)})}"persons"==n.name&&(dom.make("div",a+"persons","persons",t),dom.make("div",a+"addPersons_div","persons",t)),"resources"==n.name&&(dom.make("div",a+"resources","mfs",t),dom.make("div",a+"add_mf_div","",t),dom.p(t,""))},e.renderLanguage=function(n,t,a){var s=n.id;s>=e.lang_id_counter&&(e.lang_id_counter=s+1),console.log("Rendering lang with id "+s);var i=a+s+"_div",l=[];l.push("ISO639-3 Code: "+n.code);var d=[];if(d.push(o("bundle","name")+": "),"LOCAL"==n.name_type){var _=""!==n.name?n.name:o("bundle","specify_local_used_language_name");d.push(dom.textInput(void 0,a+s+"_name_input","eldp_bundle_lang_name_input","",_))}else d.push(n.name);var u=[];u.push(dom.checkbox(void 0,a+s+"_content_language","","",n.content_language)),u.push(o("bundle","content_language")+"  "),u.push(dom.checkbox(void 0,a+s+"_working_language","","",n.working_language)),u.push(o("bundle","working_language")),console.log(u),l.push(d,u),APP.GUI.FORMS.redBox(g(a+"display"),i,"bundle_language_entry",l,function(e,n,t){return function(){r.removeLanguage(e,n,t)}}(t,s,i))},e.refreshPersonName=function(n,r){var a=n.id,o=e.dom_element_prefix+a+"_person_"+r+"_name_disp",s=g(o),i=getObjectByID(n.persons.persons,r),l=i.person_id,d=t.getDisplayName(l);s.innerHTML=d},e.refreshPersonListInBundle=function(n,a){var s=n.id,i=g(e.dom_element_prefix+s+"_persons_addPersons_div");i.innerHTML="";var l=document.createElement("select");if(dom.setSelectOptions(l,t.persons.getAll(),"display_name","take_index"),t.persons.length>0&&(i.appendChild(l),dom.br(i),dom.button(i,"Add to bundle",function(e){return function(){r.addPerson(e,t.persons.idOf(l.selectedIndex))}}(s))),0===t.persons.length){var d=dom.h5(i,o("bundle","no_persons_created_yet")+"<br>");dom.link(d,"","",o("bundle","create_some_persons"),function(){APP.view("VIEW_persons")})}forAllItems(n.persons.persons,function(e){-1==a.indexOf(e.person_id)&&(console.log("There is an person in bundle with id"+s+" that does not exist anymore. Deleting!"),r.removePerson(s,e.id))})},e.refreshPersonLists=function(n,t){for(var r=getArrayWithIDs(t),a=0;a<e.pager.visible_items.length;a++)e.refreshPersonListInBundle(e.pager.visible_items[a],r)},e.displayNoBundleText=function(n){console.log("Showing no bundle text");var t=e.view_element;t.innerHTML="";var r=dom.make("h2","no_bundle_text","no_bundle_text",t);r.innerHTML=o("bundle","no_bundles_have_been_created_yet")+" "+o("bundle","why_not_create_one__before_link");var a=dom.make("a","new_bundle_link","new_bundle_link",r);a.innerHTML=o("bundle","why_not_create_one__link"),r.innerHTML+=o("bundle","why_not_create_one__after_link"),g("new_bundle_link").addEventListener("click",n),t.scrollTop=0},e.renderPerson=function(n,t){var a=n.id,o=t.id,s=""!==t.role?t.role:"Role";dom.make("div",e.dom_element_prefix+a+"_person_"+o,"person_in_bundle_wrap",g(e.dom_element_prefix+a+"_persons_persons"));var i=dom.make("div",e.dom_element_prefix+a+"_person_"+o+"_label","person_in_bundle",g(e.dom_element_prefix+a+"_person_"+o)),l=dom.h2(i);l.className="person_name_disp",l.id=e.dom_element_prefix+a+"_person_"+o+"_name_disp";var d=APP.GUI.makeSelect(i,void 0,"person_in_bundle_"+o+"_role_input","person_in_bundle_"+o+"_role_input",1,["Annotator","Author","Compiler","Consultant","Data_inputter","Depositor","Developer","Editor","Illustrator","Interpreter","Interviewee","Interviewer","Participant","Performer","Photographer","Recorder","Researcher","Research_participant","Responder","Signer","Singer","Speaker","Sponsor","Transcriber","Translator"],s,void 0);d.className="person_role_input",e.refreshPersonName(n,o),APP.GUI.icon(g(e.dom_element_prefix+a+"_person_"+o),"delete_person_"+o+"_icon","delete_person_icon","reset",function(e,n){return function(){r.removePerson(e,n)}}(a,o))},e.renderResource=function(t,a){var s=t.id,i=t.urcs,l=n.resources.getByID(t.resource_id).name,d=dom.make("div",e.dom_element_prefix+a+"_resource_"+s,"mf",g(e.dom_element_prefix+a+"_resources_resources")),_=dom.h3(d);_.innerHTML=o("bundle","object");var u=APP.GUI.icon(d,"delete_resource_"+s+"_icon","delete_resource_icon","reset");u.addEventListener("click",function(e,n){return function(){r.removeResourceAndRefresh(e,n)}}(a,s)),dom.span(d,"","resource_file_content_span",o("bundle","file_name")+"<br><input type='text' value='"+l+"'><br>"),e.renderUCRS(d,e.dom_element_prefix+a+"_resource_"+s+"_",i)},e.renderUCRS=function(e,n,t){var r=dom.input(e,n+"u","","","checkbox","u");dom.span(e,"","","U"),t.u===!0&&(r.checked=!0);var a=dom.input(e,n+"r","","","checkbox","r");dom.span(e,"","","R"),t.r===!0&&(a.checked=!0);var o=dom.input(e,n+"c","","","checkbox","c");dom.span(e,"","","C"),t.c===!0&&(o.checked=!0);var s=dom.input(e,n+"s","","","checkbox","s");dom.span(e,"","","S"),t.s===!0&&(s.checked=!0)},e.refreshBundleHeading=function(n){g(e.dom_element_prefix+n+"_label").innerHTML=""===a.bundles.getByID(n).bundle.title?o("bundle","unnamed_bundle"):o("bundle","bundle")+": "+get(e.dom_element_prefix+n+"_bundle_title")},e}(),eldp_environment.workflow[3]=function(){"use strict";var e,n,t,r={};r.parent=eldp_environment;var a=r.parent.l;return r.view_element,r.identity={id:"xml_output",title:"CMDI Output",icon:"data"},r.init=function(a){e=eldp_environment.workflow[2],n=eldp_environment.workflow[1],t=eldp_environment.workflow[0],r.view_element=a;var o=dom.h2(r.view_element,"","","");dom.link(o,"","","Download JSON of this project",APP.save_and_recall.saveActiveEnvironmentStateToFile)},r.view=function(){return APP.save(),0===e.bundles.length?(APP.alert(a("output","you_must_create_some_bundles_first")),void APP.view(e)):e.areAllBundlesProperlyNamed()?e.doAllBundlesHaveALanguage()?void r.generate():(APP.view(e),void APP.alert(a("output","bundles_must_have_one_language"))):(APP.view(e),void APP.alert(a("output","bundles_must_have_proper_name")+r.parent.not_allowed_chars))},r.functions=function(){return[{id:"link_export_corpus",icon:"download",label:"Download All Bundles",onclick:function(){APP.saveAllOutputFiles()}},{id:"link_export_bundles_as_zip",icon:"download",label:a("output","download_zip_archive"),onclick:function(){APP.zipAllOutputFiles()}}]},r.generate=function(){var r,a=g("VIEW_xml_output");a.innerHTML="";for(var o={bundles:e.bundles.getAll(),persons:n.persons,resources:t.resources},s=eldp_environment.eldp_generator(o),i=0;i<e.bundles.length;i++)r=e.bundles.get(i).bundle.title+".cmdi",APP.GUI.createXMLOutputDIV(a,"CMDI Bundle "+(i+1),"textarea_bundle_"+i,s.bundles[i],r,!1)},r}(),eldp_environment.eldp_generator=function(e){"use strict";var n,t="clarin.eu:cr1:p_1407745711992",r="ISO639-3:",a=new XMLString,o=[],s=function(){var e=strings.randomString(8,"0123456789abcdefghijklmnopqrstuvwxyz"),n=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),t=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),r=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),a=strings.randomString(12,"0123456789abcdefghijklmnopqrstuvwxyz");return"res_"+e+"_"+n+"_"+t+"_"+r+"_"+a},i=function(e,n,t){a.open("Header"),a.element("MdCreator",e),a.element("MdCreationDate",n),a.element("MdProfile",t),a.close("Header")},l=function(){return["xml:lang",get("metadata_language_select")]},d=function(e){a.open("ContentLanguages"),forEach(e,function(e){a.open("ContentLanguage"),a.element("Name",e.name),a.element("Code",r+e.code),e.content_language===!0?a.element("Use","Content"):a.element("Use","Working"),a.close("ContentLanguage")}),a.close("ContentLanguages")},_=function(e,n,r){if(a.reset(),a.header(),a.open("CMD",[["xmlns","http://www.clarin.eu/cmd/"],["xmlns:cmd","http://www.clarin.eu/cmd/"],["xmlns:dcr","http://www.isocat.org/ns/dcr"],["xmlns:ann","http://www.clarin.eu"],["xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"],["xsi:schemaLocation","http://www.clarin.eu/cmd/ http://catalog.clarin.eu/ds/ComponentRegistry/rest/registry/profiles/"+t+"/xsd"],["CMDVersion","1.1"]]),i(get("metadata_creator"),today()+"+01:00",t),a.open("Resources"),e.resources.resources.length>0){a.open("ResourceProxyList");for(var _=0;_<e.resources.resources.length;_++)o.push(s()),a.open("ResourceProxy",[["id",o[_]]]),a.element("ResourceType","Resource"),console.log(r),a.element("ResourceRef",r.getByID(e.resources.resources[_].resource_id).name),a.close("ResourceProxy");a.close("ResourceProxyList")}else a.element("ResourceProxyList","");a.element("JournalFileProxyList",""),a.element("ResourceRelationList",""),a.close("Resources"),a.open("Components"),a.open("ELDP_Bundle"),a.element("Title",e.bundle.title),a.element("ID",e.bundle.id_element),a.element("Description",e.bundle.description,[l()]),a.open("StatusInfo"),a.element("Status","in-progress"),a.element("ChangeDate",today()),a.close("StatusInfo"),c(),d(e.languages.bundle_languages),u(e.content.genre),h(e.content.keywords),p(e.persons.persons,n,e),a.open("ProjectLocations"),a.open("ProjectLocation"),a.element("Name",e.bundle.location.name),a.open("ProjectGeographic"),a.element("Country",e.bundle.location.country),a.close("ProjectGeographic"),a.close("ProjectLocation"),a.close("ProjectLocations"),b(e.resources.resources,r,e.languages.bundle_languages,e.persons.persons,n,e),a.close("ELDP_Bundle"),a.close("Components"),a.close("CMD")},u=function(e){""!=e&&(a.open("Genres"),a.element("Genre",e),a.close("Genres"))},c=function(){a.open("Depositors"),a.open("Depositor"),a.element("Role","Depositor"),a.element("AdditionalInformation",""),a.open("PersonalData"),a.open("Name"),a.element("Name",""),a.close("Name"),a.open("BiographicalData"),a.close("BiographicalData"),a.close("PersonalData"),a.element("Gender",""),a.open("Languages"),a.open("Language"),a.element("Name",""),a.element("Autoglottonym",""),a.close("Language"),a.close("Languages"),a.close("Depositor"),a.close("Depositors")},m=function(e){0!=e.length&&(a.open("Languages"),forEach(e,function(e){a.open("Language"),a.element("Name",e.name),a.element("Code",r+e.iso_code),a.element("Additional_Information",e.additional_information),a.close("Language")}),a.close("Languages"))},p=function(e,n,t){0!==e.length&&(a.open("Persons"),forEach(e,function(e){var r=n.getByID(e.person_id);a.open("Person"),a.element("PersonID",""),""!==t.bundle.date.year&&"YYYY"!==t.bundle.date.year&&a.element("Age_at_Time_of_Recording",t.bundle.date.year-r.birth_year),a.element("Role",e.role),a.element("AdditionalInformation",r.person_additional_information),a.element("BiographicalNote",r.biographical_note);var o=strings.linesToArray(r.ethnicity),s=strings.linesToArray(r.ethnicity_additional_info);if(o.length==s.length&&0!=o.length)for(var i=0;i<o.length;i++)a.open("Ethnicity"),a.element("EthnicAffiliation",o[i]),a.element("AdditionalInformation",s[i]),a.close("Ethnicity");a.open("PersonalData"),a.open("Name"),a.element("Title",r.title),""!==r.nameKnownAs&&a.element("Name",r.nameKnownAs,[["kind","KnownAs"]]),""!==r.fullName&&a.element("Name",r.fullName,[["kind","FullName"]]),""!==r.nameSortBy&&a.element("Name",r.nameSortBy,[["kind","asSortBy"]]),a.close("Name"),a.open("BiographicalData"),a.element("BirthYear","YYYY"!=r.birth_year?r.birth_year:""),"YYYY"!=r.death_year&&""!=r.death_year&&a.element("DeathYear",r.death_year),a.close("BiographicalData"),a.close("PersonalData"),a.open("Gender"),a.element("GenderIdentification",r.sex),a.element("AdditionalInformation",""),a.close("Gender"),a.open("Education"),a.element("Level",r.education),a.element("AdditionalInformation",""),a.close("Education"),m(r.languages.actor_languages);
var l=strings.linesToArray(r.nationality),d=strings.linesToArray(r.nationality_additional_info);if(l.length==d.length&&0!=l.length)for(var i=0;i<l.length;i++)a.open("Nationality"),a.element("Name",l[i]),a.element("AdditionalInformation",d[i]),a.close("Nationality");a.close("Person")}),a.close("Persons"))},f=function(e,n,t,r,o,s,i){log(e),a.open("Resource",[["ref",i]]),a.element("Title",n.name),a.element("ID",""),a.element("Host",""),a.open("StatusInfo"),a.element("Status",n.status),a.element("ChangeDate",today()),a.close("StatusInfo"),c(),d(t),u(s.content.genre),h(s.content.keywords),p(r,o,s),a.open("AccessInformation"),a.element("Restrictions",s.resources.access_restrictions),a.element("ConditionsofAccess",s.resources.access_conditions);var l="Open Access";1==e.urcs.u&&(l="User"),1==e.urcs.r&&(l="Researcher"),1==e.urcs.c&&(l="Community member"),1==e.urcs.s&&(l="Subscriber"),a.element("oURCS",l),a.close("AccessInformation"),g(n),a.close("Resource")},g=function(e){var n={eaf:"TextFile",txt:"TextFile",jpg:"ImageFile",png:"ImageFile",tif:"ImageFile",bmp:"ImageFile",wav:"AudioFile",mp4:"VideoFile",avi:"VideoFile"},t=strings.getFileTypeFromFilename(e.name);if(n[t])var r=n[t];else r="TextFile";a.open("File"),a.open(r),a.open("General"),a.element("Name",e.name);var o=parseDate(e.lastModified);if(null!=o)var s=dateAsString(o);else s="1977-01-01";a.element("Date",s),a.close("General"),a.element("Checksum",""),a.close(r),a.close("File")},h=function(e){if(e=strings.linesToArray(e),0==e.length||1==e.length&&""==e[0])return"";a.open("Keywords");for(var n=0;n<e.length;n++)a.element("Keyword",e[n]);a.close("Keywords")},b=function(e,t,r,s,i,l){0!==e.length&&(a.open("Resources"),forEach(e,function(e){var a=t.getByID(e.resource_id);f(e,a,r,s,i,l,o[n]),n+=1}),a.close("Resources"))},v={};return v.bundles=map(e.bundles,function(t){return a.reset(),n=0,_(t,e.persons,e.resources),a.getString()}),v};