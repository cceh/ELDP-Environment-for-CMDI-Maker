var eldp_environment=function(){"use strict";var e={};return e.name="eldp",e.id="eldp",e.title="ELDP",e.version="1.11",e.min_cmdi_maker_version="2.9",e.workflow=[],e.languages=[],e.not_allowed_chars=" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:áÁäÄàÀéÉîöÖóÓòÒüÜúÚùÙ",e.l=function(n,t,a){return APP.getTermInActiveLanguage(e.languages,n,t,a)},e.metadataLanguageIDs=[["eng","English"],["ger","German"],["spa","Spanish"],["fra","French"],["rus","Russian"],["ind","Indonesian"],["por","Portuguese"],["arb","Standard Arabic"]],e.init=function(){e.displayMetadataLanguages()},e.displayMetadataLanguages=function(){var n=g("metadata_language_select");dom.setSelectOptions(n,e.metadataLanguageIDs,1,0,!1)},e.settings=function(){return[{title:e.l("settings","calculate_persons_age"),description:e.l("settings","calculate_persons_age_description"),type:"toggle",default_value:!0,name:"radio_age_calc",id:"radio_age_calc"},{title:e.l("settings","global_language_of_metadata"),type:"select",name:"metadata_language",id:"metadata_language_select"},{title:e.l("settings","cmdi_metadata_creator"),description:e.l("settings","cmdi_metadata_creator_description"),type:"text",name:"metadata_creator",id:"metadata_creator",value:"CMDI Maker User"},{title:"Repair broken CMP file",type:"file",file_input_id:"cmp_repair_input",file_input_name:"cmp_repair_input",onchange:function(n){var t=n.target.files[0];console.log(t);var a=strings.removeEndingFromFilename(t.name)+"_repaired.cmp";readFileAsJSON(t,function(n){console.log(n);var t=e.repair(n);APP.saveTextfile(JSON.stringify(t,null,"	"),a,"application/json")})}}]},e.recall=function(e){APP.GUI.setToggleValue(g("radio_age_calc"),e.calc_actors_age)},e.getSaveData=function(){var e={};return e.calc_actors_age=g("radio_age_calc").on,e},e.reset=function(){},APP.environments.add(e),e}();eldp_environment.languages[0]={id:"english",name:"English",terms:{workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Calculate Person's Age",calculate_persons_age_description:"When this feature is activated, CMDI Maker checks if the age of an person (if it has not been specified already) can be calculated from the person's birth date and the bundle date.<br>When an age can be calculated, it will appear in the output file.<br>(Age = Bundle Date - person's Birth Date)",output_format:"Output Format",export_persons_as_json:"Export persons as JSON",import_persons_from_json_or_imdi:"Import persons from JSON or IMDI",import_persons_description:"Please import UTF-8 encoded files only!",delete_persons_database:"Delete persons Database",delete_persons_database_description:"CMDI Maker saves all your persons in a Web Storage browser database, so that they are kept, even if you close the browser window.",global_language_of_metadata:"Global Language of Metadata",cmdi_metadata_creator:"CMDI Metadata Creator",cmdi_metadata_creator_description:"The CMDI metadata format requires the name of a metadata creator. This is probably you. If so, please type in your name."},languages:{set_global_languages_of_content:"Set Global Languages of Content",or_type_in_iso_code:"or type in ISO code",language_search:"Language Search",result:"result",results:"results",language_name:"Language Name",is_new_global:"is a new Global Content Language",iso_code:"ISO code",not_found_in_db:"not found in database",specify_search_request_at_least_3_chars:"Please specify your search request.\nType in at least 3 characters.",primary_language:"Primary Language",mother_tongue:"Mother Tongue",current_content_languages:"Current Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" removed',additional_information:"Additional Information",additional_information_description:"This category gives background information to how competent the person is in the language or how the person is associated with the language, for example spoken native-like, spoken a bit, understood but not spoken, and language of ethnic identification, or any other description that you find useful."},resources:{unknown:"Unknown",create_one_bundle_per_file:"Create one bundle per file",files:"Files",selected_files:"Selected Files",sort_alphabetically:"Sort Files alphabetically",remove:"Remove",clear_file_list:"Clear File List",usage:"Usage",click:"Click",click_to_select:"Select resource, click again to deselect a single resource",shift:"Shift",shift_to_select_multiple:"Hold shift to select multiple resources",escape:"Escape",escape_to_deselect:"Press escape to deselect all resources",size:"Size",path:"Path",last_modified:"Last modified",no_resource_files_imported:"No resource files imported.",fade:"Fade",fade_explanation:"Resources are faded down when they will be included in bundles.<br>This is to prevent selecting them mistakenly.",set_for_all:"Set for all",stable_description:"These tick boxes indicate the current status of file. Not all transcriptions and annotations are necessarily completed when a file first goes into an archive and this category explicitly acknowledges that.\nFor example, if a recording has been done and converted and no further work is planned, tick Stable to indicate that the file is not likely to change again. If a transcription is completed and no further work is planned, you can also tick Stable to indicate that the file is not likely to change.",in_progress_description:"These tick boxes indicate the current status of file. Not all transcriptions and annotations are necessarily completed when a file first goes into an archive and this category explicitly acknowledges that.\nFor example, if a transcription may still be corrected or another layer of annotation will be added, tick In Progress to indicate that the file is still likely to change."},persons:{new_person:"New Person",delete_this_person:"Delete this person",sort_persons_alphabetically:"Sort persons alphabetically",persons_alphabetically_sorted:"persons sorted",save_and_duplicate_this_person:"Save and duplicate this person",duplicate_this_person:"Duplicate this person",yes_delete_all_persons:"Yes, delete all persons",no:"No",ok:"OK",confirm_erasing_persons_db:"Really?<br>You want to erase the whole persons database?",all_persons_deleted:"All persons deleted",save_person:"Save person",save_changes_to_this_person:"Save changes to this person",there_are_no_persons:"There are no persons!",persons_imported:"persons imported",person_saved_and_duplicated:"Person saved and duplicated.",give_your_person_a_name_first:"Please give your person a name first.",yes_delete_person:"Yes, delete person",really_erase_before_name:"Really?<br>You want to erase ",really_erase_after_name:"?",person_deleted_before_name:"",person_deleted_after_name:" deleted",there_are_no_persons_yet:"There are no persons yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",please_give_all_persons_a_name_before_creating_new_one:"Please give all your persons a name first, before creating a new one!",really_erase_this_person:"Really?<br>You want to erase this person?",unnamed_person:"Unnamed person"},bundle:{new_bundle:"New Bundle",copy_bundle_1_metadata:"Copy Bundle 1 metadata to all bundles",reset_form:"Reset Form",sort_by_name:"Sort by name",add_to_bundle:"Add to bundle",no_files_have_been_added:"No files have been added.",add_some_files:"Add some files.",new_bundle_has_been_created:"A new bundle has been created.",name:"Name",unnamed_bundle:"Unnamed Bundle",bundle:"Bundle",delete_bundle:"Delete Bundle",expand_bundle:"Expand Bundle",collapse_bundle:"Collapse Bundle",expand_collapse_bundle:"Expand/collapse bundle",no_persons_created_yet:"No persons have been created yet.",create_some_persons:"Create some persons.",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",yes_delete_bundle:"Yes, delete bundle",bundle_deleted:"Bundle deleted",no_bundles_have_been_created_yet:"No bundles have been created yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",this_person_is_already_in_the_bundle:"This person is already in the bundle.",unknown_file_problem__before_filename:"We have a problem.<br>I don't know if this file is a Media File or a Written Resource:",unknown_file_problem__after_filename:"As for now, I will handle it as a written resource. But you really shouldn't do that.",bundle_name_taken_from_eaf:"Bundle name has been taken from EAF file name, since bundle has not been manually named yet.",bundle_date_extracted_from_eaf_file_name:"Bundle date has been extracted from EAF file name",at_least_2_bundles_to_assign_metadata:"There have to be at least 2 bundles to assign metadata from one to another.",bundle_1_metadata_assigned_to_all_bundles:"Bundle 1 metadata assigned to all bundles.",this_function_is_currently_unavailable:"This function is currently unavailable!",no:"No",yes_delete_form:"Yes, delete form",really_reset_form:"Really?<br>You want to reset the form and delete all bundles?",form_reset:"Form reset",specify_local_used_language_name:"Specify local used language name",subject_language:"Subject Language",content_language:"Content Language",content_language_hover:"A language that is used by the participants in the recording to communicate with one another and to express communicative content. In elicitation sessions, content language refers to the language that is under investigation, for example if English words are used to elicit Ikaan words, Ikaan is the content language.",working_language:"Working Language",working_language_hover:"A language that is used in the materials in the bundle as a meta language, for example a language that speech is translated into as in a conversation in Ikaan that is translated into Yoruba and English. In such as case, both Yoruba and English would be entered under Languages as working languages, even if no-one in the recording speaks any Yoruba or English. In elicitation sessions, working language refers to the language that is used to elicit data, for example if English words are used to elicit Ikaan words, English is the working language.",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",object:"Object",file_name:"File Name",size:"Size",copy_metadata:"Copy Metadata",from_bundle_1_to_all_others:"From Bundle 1 to all others",from_2nd_last_to_last_bundle:"From second last to last bundle",elements_to_copy:"Elements to copy",from_where_to_where:"From where to where",metadata_copied:"Metadata copied",bundle_title_taken_from_eaf:"Bundle title has been taken from EAF file name, since bundle has not been manually named yet.",oURCS_description:"The letters define access to each file at ELAR. Choose between the categories U (for all ELAR users), R (for ELAR users who are researchers), C (for ELAR users who are members of the community represented in the deposit) and S (for ELAR users who been approved of as subscribers to the deposit by the depositor."},output:{bundles_must_have_proper_name:"All bundles must have proper names! Not allowed chars are: <br>",you_must_create_some_bundles_first:"You must create some bundles first!",every_bundle_must_have_a_project_name:"Every bundle must have a project name!",corpus_must_have_proper_name:"The corpus must have a proper name or no name at all.",bundles_must_have_proper_name:"Every bundle must have a proper name.<br>Unnamed bundles are not allowed.",download_corpus_including_all_bundles:"Download Corpus including all Bundles",download_zip_archive:"Download ZIP archive",not_allowed_chars_are:"Not allowed chars are: ",spaces_are_not_allowed_either:"Space characters are not allowed either.",persons_must_have_valid_birth_year:"Every person must have a valid birth year!",bundles_must_have_one_language:"Every bundle must have at least one language.",bundles_must_have_ids:"Every bundle must have an ID.",download_zip_archive:"Download ZIP archive",persons_must_have_proper_name:"There are unnamed persons. Please give every person a name first!"},really_overwrite_data:"Do you really want to overwrite data?",yes_overwrite_data:"Yes, overwrite data"}},eldp_environment.languages[1]={id:"german",name:"Deutsch",terms:{workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Automatische Altersberechnung von Personen",calculate_persons_age_description:"Wenn diese Funktion aktiviert ist, prüft CMDI Maker, ob das Alter einer Person (wenn es noch nicht angegeben worden ist) aus dem Geburtsdatum der Person und dem Datum des Bundles berechnet werden kann.<br>Wenn ein Alter berechnet werden kann, erscheint dieses in der generierten XML-Datei.<br>(Alter = Datum der Session - Geburtsdatum der Person)",output_format:"Ausgabeformat",export_persons_as_json:"Personen als JSON exportieren",import_persons_from_json:"Personen aus JSON importieren",import_persons_description:"Bitte importiere nur Dateien mit der Zeichenkodierung UTF-8!",delete_persons_database:"Alle Personen löschen",global_language_of_metadata:"Globale Metadaten-Sprache",cmdi_metadata_creator:"CMDI: Urheber der Metadaten",cmdi_metadata_creator_description:"Das CMDI-Metadatenformat setzt die Angabe eines Urhebers voraus. Das bist wahrscheinlich du! Gib in diesem Fall deinen Namen ein."},languages:{language_search:"Sprachsuche",language_name:"Language Name",iso_code:"ISO code",not_found_in_db:"wurde nicht gefunden",specify_search_request_at_least_3_chars:"Bitte sei etwas genauer.\nGib mindestens 3 Zeichen ins Suchfeld ein.",primary_language:"Primärsprache",mother_tongue:"Muttersprache",additional_information:"Additional Information"},resources:{unknown:"Unbekannt",create_one_bundle_per_file:"Ein Bundle pro Datei erstellen",files:"Dateien",selected_files:"Ausgewählte Dateien",sort_alphabetically:"Alphabetisch sortieren",remove:"Entfernen",clear_file_list:"Dateiliste löschen",usage:"Benutzung",click:"Klick",click_to_select:"Datei wird ausgewählt, noch ein Klick macht die Auswahl rückgängig",shift:"Shift",shift_to_select_multiple:"Halte Shift, um mehrere Dateien auf einmal auszuwählen",escape:"Escape",escape_to_deselect:"Alle Dateien werden deselektiert",size:"Größe",path:"Pfad",last_modified:"Letzte Änderung",no_resource_files_imported:"Keine Dateien importiert.",fade:"Ausgeblendete Dateien",fade_explanation:"Dateien werden ausgeblendet, wenn sie in einem Bundle enthalten sein werden.<br>Dies soll das versehentliche Auswählen dieser verhindern.",set_for_all:"Für alle festlegen"},persons:{new_person:"Neue Person",delete_this_person:"Diese Person löschen",sort_persons_alphabetically:"Alphabetisch sortieren",persons_alphabetically_sorted:"Personen sortiert",duplicate_this_person:"Diese Person duplizieren",yes_delete_all_persons:"Ja, alle Personen löschen",no:"Nein",ok:"OK",confirm_erasing_persons_db:"Willst du wirklich alle Personen löschen?",all_persons_deleted:"Alle Personen gelöscht",there_are_no_persons:"Es existieren keine Personen!",persons_imported:"Personen importiert",give_your_person_a_name_first:"Bitte gib der Person zuerst einen Namen.",yes_delete_person:"Ja, Person löschen",really_erase_before_name:"Willst du wirklich ",really_erase_after_name:" löschen?",person_deleted_before_name:"",person_deleted_after_name:" gelöscht",there_are_no_persons_yet:"Es existieren noch keine Personen.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eine?",please_give_all_persons_a_name_before_creating_new_one:"Bitte gib allen Personen einen Namen, bevor du eine neue erstellst!",really_erase_this_person:"Willst du diese Person wirklich löschen?",unnamed_person:"Unbenannte Person"},bundle:{new_bundle:"Neues Bundle",copy_bundle_1_metadata:"Dupliziere Bundle-1-Metadaten in allen Bundles",reset_form:"Formular zurücksetzen",sort_by_name:"Nach Namen sortieren",add_to_bundle:"Hinzufügen",no_files_have_been_added:"Es wurden noch keine Dateien importiert.",add_some_files:"Importiere welche.",new_bundle_has_been_created:"Ein neues Bundle wurde erstellt.",name:"Name",unnamed_bundle:"Unbenanntes Bundle",bundle:"Bundle",delete_bundle:"Bundle löschen",expand_bundle:"Bundle ausklappen",collapse_bundle:"Bundle minimieren",expand_collapse_bundle:"Bundle ausklappen/minimieren",no_persons_created_yet:"Es wurden noch keine Personen erstellt.",create_some_persons:"Erstelle welche.",really_erase_bundle:"Willst du wirklich ein komplettes Bundle löschen?",yes_delete_bundle:"Ja, Bundle löschen",bundle_deleted:"Bundle gelöscht",no_bundles_have_been_created_yet:"Es wurden noch keine Bundles erstellt.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eins?",this_person_is_already_in_the_bundle:"Diese Person wurde bereits zum Bundle hinzugefügt.",bundle_name_taken_from_eaf:"Der Bundle-Name wurde vom Dateinamen der EAF-Datei übernommen, da die Session noch keinen Namen hatte.",bundle_date_extracted_from_eaf_file_name:"Das Datum des Bundles wurde aus dem Dateinamen der EAF-Datei extrahiert.",at_least_2_bundles_to_assign_metadata:"Es muss mindestens 2 Bundles geben, damit von einer Session in die andere kopiert werden können.",bundle_1_metadata_assigned_to_all_bundles:"Die Metadaten von Bundle 1 wurden in allen Sessions dupliziert.",this_function_is_currently_unavailable:"Diese Funktion ist zur Zeit nicht verfügbar!",no:"Nein",yes_delete_form:"Ja, Formular zurücksetzen",really_reset_form:"Willst du das Formular wirklich zurücksetzen und alle Bundles löschen?",form_reset:"Formular zurückgesetzt",specify_local_used_language_name:"Gib den lokal benutzten Sprachnamen ein",subject_language:"Subject Language",content_language:"Content Language",working_language:"Working Language",object:"Object",file_name:"Dateiname",copy_metadata:"Metadaten kopieren",from_bundle_1_to_all_others:"Von Bundle 1 in alle anderen Bundles",from_2nd_last_to_last_bundle:"Vom vorletzten Bundle ins letzte Bundle",elements_to_copy:"Zu kopierende Elemente",from_where_to_where:"Von wo nach wo",metadata_copied:"Metadaten kopiert"},output:{bundles_must_have_proper_name:"Jedes Bundle muss einen validen Namen haben!",you_must_create_some_bundles_first:"Du musst zuerst Bundles erstellen!",download_corpus_including_all_bundles:"Corpus mit allen Bundles herunterladen",download_zip_archive:"ZIP-Archiv herunterladen",not_allowed_chars_are:"Nicht erlaubte Zeichen sind: ",spaces_are_not_allowed_either:"Leerzeichen sind auch nicht erlaubt.",bundles_must_have_one_language:"Jedes Bundle muss mindestens eine Language haben.",bundles_must_have_ids:"Jedes Bundle muss eine ID haben.",persons_must_have_valid_birth_year:"Jede Person muss ein valides Birth Year haben!",download_zip_archive:"ZIP-Archiv herunterladen"},really_overwrite_data:"Möchtest Du wirklich Daten überschreiben?",yes_overwrite_data:"Ja, Daten überschreiben"}},eldp_environment.bundle_form={title:"eldp-form",type:"form",fields:[{title:"Bundle",name:"bundle",type:"column",fields:[{heading:"Title",name:"title",type:"text",comment:"The title of the bundle without any abbreviations, for example Farm walk with Grace Adeola."},{heading:"ID",name:"id_element",type:"text",comment:"The unique identifier of the bundle, for example the beginning of the file name such as ikaan123 or uruan_dirges234. Like with file names, ID allows only lower case letters a-z (no diacritics, no umlaut, …), digits 0-9, the underscore _ and the hyphen -. No other characters are allowed."},{heading:"Date",name:"date",type:"date",comment:"The date when the primary resource in the bundle was create, for example when audio or video recordings were made or photographs were taken."},{heading:"Description",name:"description",type:"textarea",comment:"A description of the recordings, the set of photographs, annotation or other types of resources in the bundle. This description should be a reader-friendly text that someone could read in order to understand what was recorded in what situation for what purpose with whom, or what was annotated in which languages with which level of detail."},{heading:"Additional Information of Bundle",name:"additional_information",type:"textarea",comment:"Any additional information about the bundle that is considered relevant for the metadata record but that does not fit into any of the other categories."},{heading:"Location",name:"location",type:"subarea",fields:[{heading:"Name",name:"name",type:"text",comment:"The name of the location where a recording was made or a photo was taken, for example the town or village such as Ikakumo."},{heading:"Continent",name:"continent",type:"select",size:1,vocabulary:["Unknown","Unspecified","Africa","Asia","Europe","Australia","Oceania","North-America","Middle-America","South-America"],default_value:"Unspecified",comment:"The name of the continent where a recording was made or a photo was taken, for example Africa."},{heading:"Country",name:"country",type:"text",comment:"The name of the country where a recording was made or a photo was taken, for example Nigeria."},{heading:"Region",name:"region",type:"text",comment:"The name of the region, state, or administrative area where a recording was made or a photo was taken, for example Ondo State."}]}]},{title:"Content",name:"content",type:"column",comment:"The content group is used to describe the content of the bundle. This is done using four dimensions (communication context, genre, task and modalities).",fields:[{heading:"Genre",name:"genre",type:"open_vocabulary",size:1,vocabulary:["Unknown","Unspecified","Conversation","Description","Dictionary","Discourse","Elicitation","Explanation","Folktale","Historical narrative","Interview","Metadata","Narrative","Procedural narrative","Questionnaire","Ritual/religious","Song","Speech","Stimuli","Wordlist"],comment:"The genre of a recording, for example, a narrative, a song, an elicitation, …"},{heading:"Keywords",type:"textarea",name:"keywords",comment:"Terms that describe the content of the bundle in keywords, for example subject agreement, vowel harmony, pottery, children's language, farm walks, or any other useful term. You can also use this category to group related recordings or topics together, for example a series of recordings of farm walks with different people with the keyword farm walks.\nSeparate keywords by entering each new keyword in a new line in this cell."},{heading:"Recording Equipment",name:"recording_equipment",type:"textarea",comment:"A list of equipment used to create the recordings. Separate keywords by entering each new keyword in a new line in this cell."},{heading:"Recording Conditions",name:"recording_conditions",type:"textarea",comment:"Information about the recording conditions, for example noise that occurred, or the arrangement in which people were seated."}]},{title:"Languages",name:"languages",type:"column",comment:"Any of the languages that are used in the bundle, either while the recordings were made or in the transcription, translation and annotation.",fields:[{name:"bundle_languages",type:"special",object_structure:"array"}]},{title:"Persons",type:"column",name:"persons",comment:"This lists all the people that are involved in creating the material in the bundle and the role that each person had: the speakers, the researchers, the transcribers, the technicians and so on. If a person had more than one role, add the same person again and add the additional role until all the roles that the person had are listed.",fields:[{type:"special",name:"persons",object_structure:"array"}]},{title:"Objects",name:"resources",type:"column",fields:[{type:"special",name:"resources",object_structure:"array"},{heading:"Restrictions of Access",type:"textarea",name:"access_restrictions",comment:"WARNING: Please do not write any confidential content in this category. All information in this category will be openly accessible. Keywords that indicate if and why a recording, photograph, annotation or other file should have specific restrictions on access, for example women's language, sacred language, gossip, conflict, threat to life or any other category that applies to your data."},{heading:"Conditions of Access",type:"textarea",name:"access_conditions",comment:"WARNING: Please do not write any confidential content in this category. All information in this category will be openly accessible. If possible, this category describes in more detail why a certain file cannot be accessed and if and when the file will become accessible. For example, people in a community might disagree over the oral history, rulership and lineage and it has been agreed with the community as part of the ethics and access negotiations any recordings that refer to these have to be closed so as not to add to conflict in the community, and the material will only become accessible after the conflict has been resolved and members of the community have given permission for this data to become openly accessible."}]}],fields_to_copy:[{name:"date",label:"Date",fields:["bundle_date"]},{name:"location",label:"Location",fields:["bundle_location"]},{name:"content",label:"Content",fields:["content"]},{name:"persons",label:"Persons",fields:["persons_description"]},{name:"languages",label:"Languages",fields:[]},{name:"restrictions_conditions_of_access",label:"Restrictions/Conditions Of Access",fields:["resources_access_restrictions","resources_access_conditions"]}]},eldp_environment.person_form={title:"eldp-actors",type:"form",fields:[{type:"column",fields:[{heading:"Title",name:"title",type:"text",comment:"The title of a person, e.g. Dr (Mrs), Chief, Ms, Reverend, ..."},{heading:"Name (known as)",name:"nameKnownAs",type:"text",comment:"The name that a person is known as or addressed as in the community. For example, a woman may be referred to as Iya Rose (Mother of Rose) or a person may have a widely used nickname in the community such as Oyinbo (White Person)."},{heading:"Name (Full Name)",name:"fullName",type:"text",comment:"The official full name of a person, for example Dada Samuel Aminu or Mikhail Sergeyevich Gorbachev."},{heading:"Name (Sort By)",name:"nameSortBy",type:"text",comment:"The part of the name by which official records would be sorted, for example the surname of a person."},{heading:"Code",name:"code",type:"text",comment:"A unique code that is used to refer to persons, for example 93 or AO."},{heading:"Birth Year",name:"birth_year",type:"year",comment:"The year in which a person was born. If the exact year is not known, you can give an approximate year and add a comment under the category “Additional Information (Person)” stating that the birth year is approximate."},{heading:"Death Year",name:"death_year",type:"year",comment:"The year in which a person passed away."},{heading:"Gender",name:"gender",type:"select",vocabulary:["Unknown","Unspecified","Female","Male"],default_value:"Unspecified",comment:"The gender of a person."}]},{title:"",name:"",type:"column",fields:[{heading:"Ethnicities",name:"ethnicity",type:"textarea",comment:"The ethnic group to which a person belongs. Please enter all the ethnicities that a person identifies with. This is not always easy to say because people may think of themselves as belonging to more than one ethnic group, or another person might think of this person as belonging to more than one ethnic group. For example, a child of German and Greek parents brought up in London may identify with three identities: German, Greek and British."},{heading:"Additional Information (Ethnicity)",name:"ethnicity_additional_info",type:"textarea",comment:"Additional information about a person's ethnicity or ethnicities. For people with more than one ethnic affiliation, explain how these various ethnic affiliations come about."},{heading:"Nationalities",name:"nationality",type:"textarea",comment:"The nationality/nationalities that a person holds, that is, for the citizenship in a state. Please enter all the nationalities that a person holds."},{heading:"Additional Information (Nationality)",name:"nationality_additional_info",type:"textarea",comment:"Additional information about the person's nationality. Sometimes nationalities are not easy to determine, or there is a relevant history to the acquisition of the nationalities. If this should be part of the record for this person, this information can be added here."}]},{type:"column",fields:[{heading:"Education",name:"education",type:"text",comment:"Brief description of the person's highest level of educational attainment. For example, some people never went to any formal school, others went to literacy classes, Koranic school, primary school, or graduated with a BA or doctoral title from university."},{heading:"Biographical Note",name:"biographical_note",type:"textarea",comment:"General life background to a person to explain which languages a person was exposed to, at what ages, in which contexts, and so on. This helps to understand the linguistic history of a person and to better understand how and why a person may speak the way he or she does."},{heading:"Additional Information (Person)",name:"person_additional_information",type:"textarea",comment:"Any additional information about the person that is considered relevant for the metadata record for the person but that does not fit into any of the other categories."},{heading:"Anonymized",name:"anonymized",type:"check",comment:"Please tick this box to indicate that you have anonymized the metadata for the person.\nWARNING: Ticking the box does not automatically anonymize the data. It only indicates to the reader that you yourself have anonymized the data."}]},{title:"Languages",name:"languages",type:"column",comment:"This category is used to list all the languages a person speaks, understands or identifies with.\nOften, speakers of endangered languages speak various languages with different degrees of competence, understand languages that they do not actively speak, or identify with the language of their community even though they themselves do not speak it. For example, young ethnic Akaan people in Ikakumo may speak Yoruba natively, speak English a bit because they speak it in school, understand Ebira because their school friends use it, and may say that Ikaan is their language because it is the language of the community even though they themselves are not able to speak it. In such as case, enter all the languages (Yoruba, English, Ebira and Ikaan) for this person.",fields:[{heading:"Actor Languages",name:"actor_languages",type:"special",object_structure:"array"}]}]},eldp_environment.workflow[0]=function(){"use strict";var e,n={};return n.parent=eldp_environment,n.l=n.parent.l,n.fileSelection=void 0,n.resources=new ObjectList,n.identity={id:"resources",title:"Resources",icon:"blocks"},n.view_id="VIEW_resources",n.substitute_for_bad_chars="_",n.init=function(t){e=eldp_environment.workflow[2];var a=dom.make("div","files","",t);dom.h3(a,"Import Files");APP.GUI.FORMS.fileDropZone(a,"drop_zone",n.pushFileMetadata),dom.make("div","","workspace-usageTable",a,"<h3>"+n.l("resources","usage")+"</h3><h4>"+n.l("resources","click")+"</h4><p>"+n.l("resources","click_to_select")+"</p><h4>"+n.l("resources","shift")+"</h4><p>"+n.l("resources","shift_to_select_multiple")+"</p><h4>"+n.l("resources","escape")+"</h4><p>"+n.l("resources","escape_to_deselect")+"</p><h4>"+n.l("resources","fade")+"</h4><p>"+n.l("resources","fade_explanation")+"</p>");dom.h3(a,"Import File List");var r=dom.input(a,"file_list_import_input","","","file");r.addEventListener("change",n.handleFileListInputChange,!1);{var o=dom.make("div","file_list_div","",t);dom.make("div","list","",o)}n.fileSelection=new APP.GUI.selectionMechanism("file_entry_","selected_file",function(e){n.resources.get(e.index).selected=e.selected,n.fadeFilesThatStartWithSameNameAsSelectedOnes()}),n.refresh(!0)},n.view=function(){APP.GUI.scrollTop()},n.getFileType=function(e){var t=n.file_types,r=e.lastIndexOf("."),o=e.slice(r+1),s={type:n.l("resources","unknown"),mimetype:n.l("resources","unknown")},i=a(t.valid_lamus_written_resource_file_types,0),l=i.indexOf(o);
return-1!=i.indexOf(o)?(s.type=t.valid_lamus_written_resource_file_types[l][2],s.mimetype=t.valid_lamus_written_resource_file_types[l][1],s):(i=a(t.valid_lamus_media_file_types,0),l=i.indexOf(o),-1!=i.indexOf(o)?(s.type=t.valid_lamus_media_file_types[l][2],s.mimetype=t.valid_lamus_media_file_types[l][1],s):(i=a(t.invalid_lamus_media_file_types,0),l=i.indexOf(o),-1!=l?(s.type=t.invalid_lamus_media_file_types[l][2],s.mimetype=t.invalid_lamus_media_file_types[l][1],s):(i=a(t.invalid_lamus_written_resource_file_types,0),l=i.indexOf(o),-1!=l?(s.type=t.invalid_lamus_written_resource_file_types[l][2],s.mimetype=t.invalid_lamus_written_resource_file_types[l][1],s):s)))},n.file_types={valid_lamus_written_resource_file_types:[["eaf","text/x-eaf+xml","Annotation"],["mdf","Unknown","Unspecified"],["pdf","application/pdf","Primary Text"],["xml","text/xml","Annotation"],["txt","text/plain","Unspecified"],["htm","text/html","Unspecified"],["html","text/html","Unspecified"]],valid_lamus_media_file_types:[["wav","audio/x-wav","audio"],["mpg","video/mpeg","video"],["mpeg","video/mpeg","video"],["mp4","video/mp4","video"],["aif","audio/x-aiff","audio"],["aiff","audio/x-aiff","audio"],["jpg","image/jpeg","image"],["jpeg","image/jpeg","image"],["png","image/png","image"],["tif","image/tiff","image"],["tiff","image/tiff","image"],["smil","application/smil+xml","video"]],invalid_lamus_written_resource_file_types:[["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document","Unspecified"],["doc","application/msword","Unspecified"],["odf","application/vnd.oasis.opendocument.formula","Unspecified"],["odt","application/vnd.oasis.opendocument.text","Unspecified"],["xls","application/vnd.ms-excel","Unspecified"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Unspecified"],["ppt","application/vnd.ms-powerpoint","Unspecified"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation","Unspecified"]],invalid_lamus_media_file_types:[["mkv","Unknown","video"],["mov","video/quicktime","video"],["mp3","Unknown","audio"],["avi","video/x-msvideo","video"],["au","audio/basic","audio"]]},n.recall=function(e){e&&n.resources.setState(e),n.refresh()},n.getSaveData=function(){return n.resources.getState()},n.functions=function(){return[{label:n.l("resources","create_one_bundle_per_file"),icon:"plus",id:"crps_icon",wrapper_id:"crps_div",type:"function_wrap",sub_div:"crps_filetype_select",onclick:function(){n.createBundlePerResource(),APP.view(e)},sub_div_innerHTML:'<h3 class="inner_function_h3">'+n.l("resources","files")+'</h3><input type="radio" name="radio_file_type" value="selected" checked> '+n.l("resources","selected_files")+'<br><input type="radio" name="radio_file_type" value="eaf"> EAF<br><input type="radio" name="radio_file_type" value="wav"> WAV<br><input type="radio" name="radio_file_type" value="mpg"> MPG<br><input type="radio" name="radio_file_type" value="mp4"> MP4<br>'},{id:"link_sort_alphabetically",icon:"az",label:n.l("resources","sort_alphabetically"),onclick:function(){n.sortAlphabetically()}},{id:"link_remove_files",icon:"reset",label:n.l("resources","remove"),onclick:function(){n.removeSelectedFiles()}},{id:"link_clear_file_list",icon:"reset",label:n.l("resources","clear_file_list"),onclick:function(){n.reset()}},{id:"link_set_for_all",icon:"submit",label:n.l("resources","set_for_all"),wrapper_id:"sfa_div",type:"function_wrap",sub_div:"sfa_select",onclick:function(){n.setForAll()},sub_div_innerHTML:'<input type="radio" name="status_for_all" id="stable_for_all" value="stable" checked> Stable<br><input type="radio" name="status_for_all" id="inProgress_for_all" value="in-progress"> In Progress<br>'}]},n.setForAll=function(){console.log(dom.getSelectedRadioValue("status_for_all")),n.resources.setForAll("status",dom.getSelectedRadioValue("status_for_all")),n.refresh()},n.getValidityOfFile=function(e){var t,a=strings.getFileTypeFromFilename(e);for(t=0;t<n.file_types.valid_lamus_media_file_types.length;t++)if(a==n.file_types.valid_lamus_media_file_types[t][0])return 0;for(t=0;t<n.file_types.valid_lamus_written_resource_file_types.length;t++)if(a==n.file_types.valid_lamus_written_resource_file_types[t][0])return 1;for(t=0;t<n.file_types.invalid_lamus_media_file_types.length;t++)if(a==n.file_types.invalid_lamus_media_file_types[t][0])return 2;for(t=0;t<n.file_types.invalid_lamus_written_resource_file_types.length;t++)if(a==n.file_types.invalid_lamus_written_resource_file_types[t][0])return 3;return-1},n.refresh=function(t){var a=g("list");a.innerHTML="",n.resources.forEach(function(e,t){n.renderResource({number:t,title:e.name,mime_type:e.mime_type,file_size:e.size,lastModified:e.lastModified,id:"file_entry_"+t,className:"file_entry media_file_entry",parent:a,status:e.status,path:e.path})}),0===n.resources.length&&(a.innerHTML="<h2>"+n.l("resources","no_resource_files_imported")+"</h2>"),e&&!t&&e.refresh(),n.fileSelection.selected_files=[]},n.refreshFileStateValues=function(e){n.resources.get(e).status=dom.getSelectedRadioValue("f_"+e+"_status")},n.renderResource=function(e){{var t=dom.make("div",e.id,e.className,e.parent),a=(dom.make("h2","","file_entry_title",t,e.title),dom.make("p","","",t,e.mimeType+'<br><span class="size_span">'+n.l("resources","size")+": "+e.file_size+'</span><br><span name="date_span" class="date_span">'+n.l("resources","last_modified")+": "+e.lastModified+'</span><br><span name="path_span" class="date_span">'+n.l("resources","path")+": "+e.path+"</span>"),[{title:"Stable",value:"stable"},{title:"In Progress",value:"in-progress"}]);dom.makeRadios(t,a,"f_"+e.number+"_status","f_"+e.number+"_status_","title","value",e.status,function(){n.refreshFileStateValues(e.number)},[n.l("resources","stable_description"),n.l("resources","in_progress_description")])}t.addEventListener("click",function(e){return function(){n.fileSelection.clickedOnFile(e)}}(e.number),!1)},n.pushFileMetadata=function(e){for(var t,a=0;t=e[a];a++)n.resources.add({name:t.name,type:t.type||"n/a",size:strings.bytesToSize(t.size,1),lastModified:t.lastModifiedDate.toLocaleDateString(),status:"stable"});n.refresh()},n.sortAlphabetically=function(){n.resources.sortByKey("name"),n.refresh()},n.createBundlePerResource=function(){var e,t=dom.getByName("radio_file_type"),a=dom.getSelectedRadioValue(t);if(console.log("Searching for files of chosen file type "+a),"selected"!=a)for(e=0;e<n.resources.length;e++){var r=strings.getFileTypeFromFilename(n.resources.get(e).name);r==a&&(console.log("Found a file of file type "+a),n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(n.resources.idOf(e)))}else for(console.log("Searching for selected files"),e=0;e<n.fileSelection.selected_files.length;e++){var o=n.resources.idOf(n.fileSelection.selected_files[e]);n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(o)}},n.removeSelectedFiles=function(){var e=n.fileSelection.selected_files,t=n.resources.mapIndexesToIDs(e);n.resources.removeByID(t),n.refresh()},n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd=function(t){var a=strings.replaceAccentBearingLettersWithASCISubstitute(strings.removeEndingFromFilename(n.resources.getByID(t).name));a=strings.replaceCharactersInStringWithSubstitute(a,n.parent.not_allowed_chars,n.substitute_for_bad_chars);var r=!1,o=[];o.push(t);var s=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(t);o.push.apply(o,s),e.createNewBundleWithResources(a,r,o)},n.getIDsOfResourcesThatStartWithTheSameNameAsThis=function(e){var t=n.resources.getByID(e),a=n.resources.filter(function(n){return e==n.id?!1:strings.isSubstringAStartOfAWordInString(strings.removeEndingFromFilename(n.name),strings.removeEndingFromFilename(t.name))?!0:!1}),r=getArrayWithIDs(a);return r},n.fadeFilesThatStartWithSameNameAsSelectedOnes=function(){for(var e,t="file_entry_",a=[],r=0;r<n.resources.length;r++)g(t+r.toString()).style.opacity="1";for(var o=0;o<n.fileSelection.selected_files.length;o++){var s=n.fileSelection.selected_files[o],i=n.resources.idOf(s);a.push(i);var l=n.resources.idOf(s);e=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(l);for(var d=0;d<e.length;d++)a.push(e[d])}for(r=0;r<a.length;r++){var u=n.resources.indexOf(a[r]);g(t+u.toString()).style.opacity="0.5"}},n.handleFileListInputChange=function(e){var t,a=e.target.files[0];return"txt"!=strings.getFileTypeFromFilename(a.name)?void APP.log("File List must be of type TXT!","error"):void readFileAsText(a,function(e){try{t=strings.linesToArray(e)}catch(a){return void console.info("No files found! Maybe this file list is not valid!")}forEach(t,function(e){e.length>0&&" "!=e&&n.resources.add({name:strings.getFilenameFromFilePath(e),path:strings.getDirectoryFromFilePath(e),status:"stable"})}),n.refresh()})},n.reset=function(){n.resources.reset(),n.refresh()},n}(),eldp_environment.workflow[1]=function(){"use strict";var e=function(){forEach(o.persons.getActive().languages.actor_languages,o.languages.set)},n=function(){var e=o.languages.languages_of_active_person.map(function(e){return"LOCAL"==e.name_type&&(e.name=get("person_languages_"+e.id+"_name_input")),e.additional_information=get("person_languages_"+e.id+"addInfo"),e});return e},t=function(){var e=APP.forms.createEmptyObjectFromTemplate(d);return APP.forms.fillObjectWithFormData(e,o.element_id_prefix,d),e.languages.actor_languages=n(),e},a=function(e){o.saveActivePerson("without_refreshing"),o.show(o.persons.idOf(e))},r=function(){return!o.persons.isThereAnyItemWhereKeyIsValue("name","")},o={};o.parent=eldp_environment;var s,l=function(e,n){return o.parent.l("persons",e,n)},d=o.parent.person_form;return o.persons=new ObjectList,o.element_id_prefix="person_",o.identity={id:"persons",title:"Persons",icon:"user"},o.module_view,o.init=function(e){o.persons.reset(),o.module_view=e,s=o.parent.workflow[2],o.gui_list=new APP.GUI.FORMS.clickableListSmall(e,[],[],a,o.element_id_prefix+"list",0);dom.make("div",o.element_id_prefix+"view","",e);o.languages.init(),o.refresh(!0)},o.getSaveData=function(){o.saveActivePerson("without_refreshing");var e={persons:o.persons.getState()};return e},o.showNoPersonsMessage=function(){var e=o.module_view;e.innerHTML="";var n=dom.make("h2","no_persons_text","no_persons_text",e);n.innerHTML=l("there_are_no_persons_yet")+" "+l("why_not_create_one__before_link");var t=dom.make("a","new_person_link","new_person_link",n);t.innerHTML=l("why_not_create_one__link"),n.innerHTML+=l("why_not_create_one__after_link"),g("new_person_link").addEventListener("click",function(){o.createNewPerson()})},o.recall=function(e){o.persons.setState(e.persons),o.refresh(),o.show(o.persons.getPointer())},o.functions=function(){return[{id:"link_new_person",icon:"plus",label:l("new_person"),onclick:function(){o.createNewPerson()}},{id:"link_delete_active_person",icon:"reset",label:l("delete_this_person"),onclick:function(){o.handleClickOnDeletePerson()}},{id:"link_sort_persons_alphabetically",icon:"az",label:l("sort_persons_alphabetically"),type:"function_wrap",wrapper_id:"sa_div",sub_div:"sa_subdiv",sub_div_innerHTML:'<input type="radio" name="sa_by" value="nameKnownAs"> By Name (known as)<br><input type="radio" name="sa_by" value="fullName" checked> By Full Name<br><input type="radio" name="sa_by" value="nameSortBy"> By Name (Sort By)',onclick:function(){o.saveActivePerson();var e=dom.getSelectedRadioValue(dom.getByName("sa_by"));o.persons.sortByKey(e),o.refresh(),APP.log(l("persons_alphabetically_sorted"))}},{id:"link_duplicateActivePerson",icon:"duplicate_user",label:l("duplicate_this_person"),onclick:function(){o.saveActivePerson(),o.persons.duplicateActive(),o.refresh(),APP.log(l("person_saved_and_duplicated"),"success")}}]},o.erase_database=function(){APP.confirm(l("confirm_erasing_persons_db"),function(e){e||(o.persons.reset(),APP.log(l("all_persons_deleted")),o.refresh())},l("no"),l("yes_delete_all_persons"))},o.show=function(n){if(0==o.persons.length)return void console.info("person.show: No persons to show!");var t=o.persons.getIndexByID(n);"undefined"==typeof t&&(console.warn("person.show: Undefined person_id! Showing person 0"),t=0),console.log("Showing person "+t),o.createFormIfNotExistent(),o.gui_list.changeHighlight(t),o.languages.clearActivePersonLanguages(),o.persons.setPointer(n),o.refreshFormTitle();var a=o.persons.getActive();APP.forms.fill(d,o.element_id_prefix,a),e()},o.refreshFormTitle=function(){var e=g(o.element_id_prefix+"form_title"),n=o.getDisplayName(o.persons.getActive());e.innerHTML=""==n?l("unnamed_person"):n},o.createFormIfNotExistent=function(){var e=g("person_view");if(!e){e=dom.make("div","person_view","person_view",o.module_view),e.innerHTML="";var n=dom.make("div",o.element_id_prefix+"title_div","",e);dom.make("h1",o.element_id_prefix+"form_title","",n,l("new_person")),dom.make("div",o.element_id_prefix+"content_div","",e),APP.forms.make(g(o.element_id_prefix+"content_div"),d,o.element_id_prefix,o.element_id_prefix,void 0,o.languages.makeInputInForm),g(o.element_id_prefix+"nameKnownAs").addEventListener("blur",o.saveActivePerson),g(o.element_id_prefix+"fullName").addEventListener("blur",o.saveActivePerson),g(o.element_id_prefix+"nameSortBy").addEventListener("blur",o.saveActivePerson)}},o.saveActivePerson=function(e){if(-1!=o.persons.getPointer()){var n=t();return n.display_name=o.getDisplayName(n),"without_refreshing"!=e?(o.save(n),o.refresh(),o.refreshFormTitle()):o.save(n,"without_bundle_refresh"),n}},o.save=function(e,n){return o.persons.replaceActive(e),"without_bundle_refresh"!=n&&s.updatePersonNameInAllBundles(e.id),e},o.createNewPerson=function(e){if(o.saveActivePerson(),!r())return void APP.alert(l("please_give_all_persons_a_name_before_creating_new_one"));e||(e=APP.forms.createEmptyObjectFromTemplate(d)),e.display_name=o.getDisplayName(e);var n=o.persons.add(e);o.createFormIfNotExistent(),o.refresh(),o.show(n)},o.handleClickOnDeletePerson=function(){if(-1==typeof o.persons.pointer)return void console.warn("Active Person is undefined. Don't know what to delete!");var e,n=o.persons.getActive().name;e=""==n?l("really_erase_this_person"):l("really_erase_before_name")+n+l("really_erase_after_name"),APP.confirm(e,function(e){e||(o.deleteActivePerson(),APP.log(l("person_deleted_before_name")+n+l("person_deleted_after_name")))},l("no"),l("yes_delete_person"))},o.deleteActivePerson=function(){o.persons.removeActive(),o.refresh()},o.getAge=function(e,n){var t=o.persons.getByID(n);if(""===t.age){if(g("radio_age_calc").on){var a=t.birth_date.year+"-"+t.birth_date.month+"-"+o.persons[i].birth_date.day,r=get(s.dom_element_prefix+e+"_bundle_date_year")+"-"+get(s.dom_element_prefix+e+"_bundle_date_month")+"-"+get(s.dom_element_prefix+e+"_bundle_date_day"),l=calcAgeAtDate(r,a);return 0!==l?(console.info("person's age successfully calculated"),l):"Unspecified"}return"Unspecified"}return t.age},o.refresh=function(e){o.module_view.innerHTML="";var n=o.persons.map(function(e){return o.getDisplayName(e.id)});o.gui_list.refresh(n),0==o.persons.length?(o.showNoPersonsMessage(),APP.environments.disableFunction("link_delete_active_person"),APP.environments.disableFunction("sa_div"),APP.environments.disableFunction("link_duplicateActivePerson")):(o.createFormIfNotExistent(),o.show(o.persons.getActiveIndex()),o.gui_list.changeHighlight(o.persons.getActiveIndex()),APP.environments.enableFunction("link_delete_active_person"),APP.environments.enableFunction("sa_div"),APP.environments.enableFunction("link_duplicateActivePerson")),s&&!e&&s.refreshPersonLists(o.persons.getAll())},o.getDisplayName=function(e){var n;return"object"==typeof e?n=e:o.persons.existsByID(e)&&(n=o.persons.getByID(e)),n?n.fullName&&""!=n.fullName?n.fullName:n.nameSortBy&&""!=n.nameSortBy?n.nameSortBy:n.nameKnownAs&&""!=n.nameKnownAs?n.nameKnownAs:l("unnamed_person"):console.warn("Person undefined!")},o.doesEveryPersonHaveValidBirthYear=function(){for(var e=0;e<o.persons.length;e++){var n=o.persons.get(e).birth_year;if(n.length>4||"YYYY"==n||""==n)return!1}return!0},o.doesEveryPersonHaveALanguage=function(){for(var e=0;e<o.persons.length;e++)if(0==o.persons.get(e).languages.actor_languages.length)return!1;return!0},o.areAllPersonsNamed=function(){for(var e=0;e<o.persons.length;e++){var n=o.persons.get(e);if(""==n.fullName&&""==n.nameSortBy&&""==n.nameKnownAs)return!1}return!0},o}(),eldp_environment.workflow[1].languages=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.workflow[1];return e.languages_of_active_person=new ObjectList,e.element_id_prefix=n.element_id_prefix+"languages_",e.l=e.parent.l,e.init=function(){},e.makeInputInForm=function(n,t,a){"actor_languages"==n.name&&APP.GUI.makeLanguageSearchForm(t,a,!1,!1,e.addFromForm)},e.remove=function(n){e.languages_of_active_person.removeByID(n),dom.remove(e.element_id_prefix+n+"_div")},e.clearActivePersonLanguages=function(){e.languages_of_active_person.reset(),g(e.element_id_prefix+"display").innerHTML=""},e.set=function(n){e.languages_of_active_person.add(n),e.renderActorLanguage(g(e.element_id_prefix+"display"),n)},e.renderActorLanguage=function(t,a){var r=dom.make("div",e.element_id_prefix+a.id+"_div",e.element_id_prefix+"entry",t);if(APP.GUI.icon(r,"delete_lang_"+a.id+"_icon","delete_lang_icon","reset",function(e){return function(){n.languages.remove(e)}}(a.id)),dom.spanBR(r,"","","ISO639-3 Code: "+a.iso_code),dom.span(r,"","","Name: "),"LOCAL"==a.name_type){var o=""!==a.name?a.name:e.l("bundle","specify_local_used_language_name");dom.textInput(r,e.element_id_prefix+a.id+"_name_input","eldp_person_lang_name_input","",o)}else dom.span(r,"","",a.name);dom.br(r),dom.spanBR(r,"","","Country ID: "+a.country_code),dom.br(r),APP.GUI.makeTextarea(18,4,r,e.l("languages","additional_information"),e.element_id_prefix+a.id+"addInfo",e.element_id_prefix+a.id+"addInfo","className",a.additional_information,e.l("languages","additional_information_description"))},e.addFromForm=function(n){console.log(n);var t;t=0===e.languages_of_active_person.length?!0:!1;var a={iso_code:n[0],name:n[3],country_code:n[1],name_type:n[2],additional_information:""};e.set(a)},e}(),eldp_environment.workflow[2]=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.bundle_form;e.refresh=function(){e.render.refresh(e.bundles.getAll())},e.identity={id:"bundle",title:"Bundles",icon:"edit"},e.bundles=new ObjectList,e.lang_id_counter=0,e.resource_id_counter=0,e.person_id_counter=0,e.dom_element_prefix="bundle_",e.reset=function(){e.bundles.eraseAll(),e.refresh()};var t,a,r=e.parent.l;return e.init=function(n){t=eldp_environment.workflow[0],a=eldp_environment.workflow[1],e.bundles.reset(),e.resource_id_counter=0,e.person_id_counter=0;var r={newBundle:e.newBundle,deleteBundle:e.userErase,setLanguage:e.set,addPerson:e.addPerson,removePerson:e.removePerson,addResource:e.addResource,removeResource:e.removeResource,removeResourceAndRefresh:e.removeResourceAndRefresh,removeLanguage:e.removeLanguage};e.render.init(n,r)},e.view=function(){e.render.view()},e.recall=function(n){n.bundles&&e.bundles.setState(n.bundles),n.person_id_counter&&(e.person_id_counter=n.person_id_counter),n.lang_id_counter&&(e.lang_id_counter=n.lang_id_counter),e.refresh()},e.getSaveData=function(){e.refreshVisibleBundlesInArray();var n={bundles:e.bundles.getState(),lang_id_counter:e.lang_id_counter,person_id_counter:e.person_id_counter};return n},e.refreshVisibleBundlesInArray=function(){forEach(e.render.pager.visible_items,e.refreshBundleInArray)},e.refreshBundleInArray=function(t){var a=t;APP.forms.fillObjectWithFormData(a,e.dom_element_prefix+t.id+"_",n),forEach(a.persons.persons,function(e){e.role=get("person_in_bundle_"+e.id+"_role_input")}),forEach(a.resources.resources,function(n){n.urcs.u=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_u").checked,n.urcs.r=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_r").checked,n.urcs.c=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_c").checked,n.urcs.s=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_s").checked}),forEach(a.languages.bundle_languages,function(n){n.content_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_content_language").checked,n.working_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_working_language").checked,"LOCAL"==n.name_type&&(n.name=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_name_input").value)})},e.functions=function(){return[{label:r("bundle","new_bundle"),icon:"plus",id:"link_newBundle",onclick:function(){e.newBundle()}},{label:r("bundle","copy_metadata"),icon:"copy",id:"link_copy_bundles",wrapper_id:"copy_bundles_div",type:"function_wrap",sub_div:"copy_bundles_select",onclick:function(){e.handleClickOnCopyMetadata()},after_that:e.render.createCopyBundleOptions},{label:r("bundle","sort_by_name"),icon:"az",id:"bundle_link_sort_by_name",onclick:function(){e.refreshVisibleBundlesInArray(),e.bundles.sortBySubKey("bundle","name"),e.refresh()}}]},e.newBundle=function(){var n=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);return n.expanded=!0,e.bundles.add(n),e.refresh(),n.id},e.createNewBundleWithResources=function(n,t,a){var o=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);o.bundle.title=n,o.expanded=t,e.bundles.add(o),e.render.renderBundle(o);for(var s=0;s<a.length;s++)e.addResource(o.id,a[s]);return APP.log(r("bundle","new_bundle_has_been_created")+"<br>"+r("bundle","name")+": "+n),o.id},e.set=function(n,t,a){var r={code:n[0],name:n[3],name_type:n[2],country_code:n[1],id:e.lang_id_counter,working_language:!1,content_language:!1};e.bundles.getByID(t).languages.bundle_languages.push(r),e.render.renderLanguage(r,t,a),e.lang_id_counter+=1},e.removeLanguage=function(n,t,a){var r=e.bundles.getIndexByID(n),o=e.getLanguageObjectIndexByID(r,t);e.bundles.get(r).languages.bundle_languages.splice(o,1),dom.remove(a)},e.getLanguageObjectIndexByID=function(n,t){return getIndex(e.bundles.get(n).languages.bundle_languages,4,t)},e.getName=function(n){return""===e.bundles.get(n).name?r("bundle","unnamed_bundle"):r("bundle","bundle")+": "+e.bundles.get(n).name},e.userErase=function(n){APP.confirm(r("bundle","really_erase_bundle"),function(t){t||(e.bundles.eraseByID(n),APP.log(r("bundle","bundle_deleted")),e.refresh())},r("bundle","no"),r("bundle","yes_delete_bundle"))},e.getIndexFromResourceID=function(n){for(var t,a=0;a<e.bundles.length;a++){var r=e.bundles.get(a);for(t=0;t<r.resources.resources.length;t++)if(r.resources.resources[t].id==n)return t}},e.addPerson=function(n,t,r){if(!a.persons.getByID(t))return void console.log("Tried to add person to bundle although this person is not in the persons database. This is odd.");e.refreshVisibleBundlesInArray(),console.log("adding person in bundle with id "+n),"string"!=typeof r&&(r="");var o={id:e.person_id_counter,person_id:t,role:r};e.bundles.getByID(n).persons.persons.push(o),e.refresh(),e.person_id_counter=e.person_id_counter+1},e.removePerson=function(n,t){var a=e.bundles.getByID(n),r=a.persons.persons,o=getIndexByID(r,t);r.splice(o,1),dom.remove(e.dom_element_prefix+n+"_person_"+t)},e.addResource=function(n,a){if(!(a>=t.resources.length)){var r=t.resources.get(a),o=e.resource_id_counter,s={u:!1,r:!1,c:!1,s:!1},i={id:o,resource_id:r.id,urcs:s};if(e.bundles.getByID(n).resources.resources.push(i),"eaf"==strings.getFileTypeFromFilename(r.name)&&""===get(e.dom_element_prefix+n+"_bundle_title")){var l=strings.removeEndingFromFilename(r.name);e.bundles.getByID(n).bundle.title=l}return e.refresh(),e.resource_id_counter+=1,o}},e.removeResourceAndRefresh=function(n,t){e.removeResource(n,t),e.refresh()},e.removeResource=function(n,t){console.log("SHALL REMOVE RES. bun_id="+n+", RES_IN_BUN_ID = "+t);var a=getArrayWithIDs(e.bundles.getByID(n).resources.resources);if(-1!=a.indexOf(t)){var r=e.getIndexFromResourceID(t);e.bundles.getByID(n).resources.resources.splice(r,1)}},e.handleClickOnCopyMetadata=function(){e.refreshVisibleBundlesInArray(),"1_to_others"==get("copy_bundle_options")?e.assignBundle1Metadata():e.copyMetadataFrom2ndLastToLast(),e.refresh()},e.copyMetadataFrom2ndLastToLast=function(){if(e.bundles.length<2)return void APP.log(r("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){var a=e.bundles.getLast(),o=e.bundles.getFromEnd(1);"persons"==n.fields_to_copy[t].name&&(e.removeAllPersons(a.id),forEach(o.persons.persons,function(n){e.addPerson(a.id,n.person_id,n.role)})),"languages"==n.fields_to_copy[t].name&&(a.languages.bundle_languages=[],forEach(o.languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,a.languages.bundle_languages.push(t)})),e.copyFieldsFrom2ndLastToLastBundle(n.fields_to_copy[t].fields)}APP.log(r("bundle","metadata_copied"))},e.assignBundle1Metadata=function(){if(e.bundles.length<2)return void APP.log(r("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){if("persons"==n.fields_to_copy[t].name)for(var a=1;a<e.bundles.length;a++)e.removeAllPersons(e.bundles.idOf(a)),forEach(e.bundles.get(0).persons.persons,function(n){e.addPerson(e.bundles.idOf(a),n.person_id,n.role)});if("languages"==n.fields_to_copy[t].name)for(a=1;a<e.bundles.length;a++)e.bundles.get(a).languages.bundle_languages=[],forEach(e.bundles.get(0).languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,e.bundles.get(a).languages.bundle_languages.push(t)});e.copyFieldsToAllBundles(n.fields_to_copy[t].fields)}APP.log(r("bundle","bundle_1_metadata_assigned_to_all_bundles"))},e.copyFieldsToAllBundles=function(n){for(var t=1;t<e.bundles.length;t++)for(var a=0;a<n.length;a++)"bundle_date"==n[a]&&(e.bundles.get(t).bundle.date=cloneObject(e.bundles.getFirst().bundle.date)),"bundle_location"==n[a]&&(e.bundles.get(t).bundle.location=cloneObject(e.bundles.getFirst().bundle.location)),"content"==n[a]&&(e.bundles.get(t).content=cloneObject(e.bundles.getFirst().content)),"persons_description"==n[a]&&(e.bundles.get(t).persons.description=e.bundles.getFirst().persons.description),"resources_access_restrictions"==n[a]&&(e.bundles.get(t).resources.access_restrictions=e.bundles.getFirst().resources.access_restrictions),"resources_access_conditions"==n[a]&&(e.bundles.get(t).resources.access_conditions=e.bundles.getFirst().resources.access_conditions)},e.refreshPersonLists=function(n){e.render.refreshPersonLists(e.bundles.getAll(),n)},e.copyFieldsFrom2ndLastToLastBundle=function(n){for(var t=e.bundles.getLast(),a=e.bundles.getFromEnd(1),r=0;r<n.length;r++)"bundle_date"==n[r]&&(t.bundle.date=cloneObject(a.bundle.date)),"bundle_location"==n[r]&&(t.bundle.location=cloneObject(a.bundle.location)),"content"==n[r]&&(t.content=cloneObject(a.content)),"persons_description"==n[r]&&(t.persons.description=a.persons.description),"resources_access_restrictions"==n[r]&&(t.resources.access_restrictions=a.resources.access_restrictions),"resources_access_conditions"==n[r]&&(t.resources.access_conditions=a.resources.access_conditions)},e.removeAllPersons=function(n){e.bundles.getByID(n).persons.persons=[],e.refresh()},e.areAllBundlesProperlyNamed=function(){for(var n=0;n<e.bundles.length;n++)if(""===e.bundles.get(n).bundle.title)return!1;return!0},e.doAllBundlesHaveIDs=function(){for(var n=0;n<e.bundles.length;n++)if(""===e.bundles.get(n).bundle.id_element)return!1;return!0},e.doAllBundlesHaveALanguage=function(){for(var n=0;n<e.bundles.length;n++)if(0==e.bundles.get(n).languages.bundle_languages.length)return!1;return!0},e.updatePersonNameInAllBundles=function(){e.refreshVisibleBundlesInArray(),e.refresh()},e}(),eldp_environment.workflow[2].render=function(){"use strict";var e={};e.parent=eldp_environment;var n,t,a,r,o=e.parent.l,s=e.parent.bundle_form;return e.dom_element_prefix="bundle_",e.init=function(o,s){e.view_element=o,a=s,n=eldp_environment.workflow[0],t=eldp_environment.workflow[1],r=eldp_environment.workflow[2],e.displayNoBundleText(a.newBundle);var i={render:e.renderBundle,on_page_change:e.refresh,items_list:r.bundles.getAll(),view:o,items_per_page:10,before_page_change:r.refreshVisibleBundlesInArray};e.pager=new APP.GUI.pager(i)},e.view=function(){APP.GUI.scrollTop(),e.pager.refresh(r.bundles.getAll())},e.createCopyBundleOptions=function(){var e=g("copy_bundles_select");dom.h3(e,o("bundle","from_where_to_where"));var n=[{title:o("bundle","from_bundle_1_to_all_others"),id:"1_to_others"},{title:o("bundle","from_2nd_last_to_last_bundle"),id:"second_last_to_last"}];if(dom.makeRadios(e,n,"copy_bundle_options","","title","id",0,void 0),dom.br(e),dom.h3(e,o("bundle","elements_to_copy")),!s.fields_to_copy)return void dom.make("span","","",e,o("bundle","this_function_is_currently_unavailable"));for(var t=s.fields_to_copy,a=0;a<t.length;a++){var r=dom.input(e,APP.CONF.copy_checkbox_element_prefix+t[a].name,"","","checkbox");r.checked=!0,dom.span(e,"",""," "+t[a].label),dom.br(e)}},e.refreshResources=function(t){var r=g(e.dom_element_prefix+t+"_resources_add_mf_div");r.innerHTML="";var s=document.createElement("select");if(dom.setSelectOptions(s,n.resources.getAll(),"name","take_index",!1),n.resources.length>0&&(r.appendChild(s),dom.br(r),dom.button(r,o("bundle","add_to_bundle"),function(e){return function(){a.addResource(e,s.selectedIndex,!1)}}(t))),0===n.resources.length){var i=document.createElement("h5");r.appendChild(i),i.innerHTML=o("bundle","no_files_have_been_added")+"<br>",dom.link(i,"","",o("bundle","add_some_files"),function(){APP.view(n)})}},e.refresh=function(n){var t=e.view_element;t.innerHTML="",e.pager.refresh(n),forEach(e.pager.visible_items,e.renderBundle),0===n.length&&e.displayNoBundleText(a.newBundle)},e.renderBundle=function(o){var i=o.id,l=o.expanded,d=e.view_element;g("no_bundle_text")&&(d.innerHTML="");var u=APP.GUI.FORMS.expandableForm(d,e.dom_element_prefix+i,l,function(e){o.expanded=e.expanded},a.deleteBundle,i);APP.forms.make(u.content,s,e.dom_element_prefix+i+"_",e.dom_element_prefix,o,e.makeSpecialFormInput),g(e.dom_element_prefix+i+"_bundle_title").addEventListener("blur",function(n){return function(){e.refreshBundleHeading(n)}}(i));var c=e.dom_element_prefix+i+"_languages_";forEach(o.languages.bundle_languages,function(n){e.renderLanguage(n,i,c)}),"undefined"!=typeof o.persons&&"undefined"!=typeof o.persons.persons&&forEach(o.persons.persons,function(n){e.renderPerson(o,n)}),"undefined"!=typeof o.resources.resources&&(forAllItems(o.resources.resources,function(e){n.resources.IDexists(e.resource_id)||(log("There is a resource in bundle "+o.id+" with resource_id "+e.resource_id+" that does not exist anymore. Deleting!"),a.removeResource(o.id,e.id))}),forEach(o.resources.resources,function(n){e.renderResource(n,i),n.id>=r.resource_id_counter&&(r.resource_id_counter=n.id+1)})),e.refreshResources(i);var _=t.persons.getArrayWithIDs();e.refreshPersonListInBundle(o,_),e.refreshBundleHeading(i)},e.makeSpecialFormInput=function(n,t,r){if("bundle_languages"==n.name){var o=r.slice(e.dom_element_prefix.length,r.indexOf("_",e.dom_element_prefix.length));APP.GUI.makeLanguageSearchForm(t,r,!1,!1,function(e){a.setLanguage(e,o,r)})}"persons"==n.name&&(dom.make("div",r+"persons","persons",t),dom.make("div",r+"addPersons_div","persons",t)),"resources"==n.name&&(dom.make("div",r+"resources","mfs",t),dom.make("div",r+"add_mf_div","",t),dom.p(t,""))},e.renderLanguage=function(n,t,r){var s=n.id;s>=e.lang_id_counter&&(e.lang_id_counter=s+1);var i=r+s+"_div",l=APP.GUI.FORMS.redBox(g(r+"display"),i,"bundle_language_entry","",function(e,n,t){return function(){a.removeLanguage(e,n,t)}}(t,s,i));if(l.content.innerHTML+="ISO639-3 Code: "+n.code,dom.br(l.content),l.content.innerHTML+=o("bundle","name")+": ","LOCAL"==n.name_type){var d=""!==n.name?n.name:o("bundle","specify_local_used_language_name");dom.textInput(l.content,r+s+"_name_input","eldp_bundle_lang_name_input","",d)}else l.content.innerHTML+=n.name;
dom.br(l.content);var u=dom.checkbox(l.content,r+s+"_content_language","","",n.content_language);u.title=o("bundle","content_language_hover");var c=dom.span(l.content,"","",o("bundle","content_language")+"  ");c.title=o("bundle","content_language_hover"),u=dom.checkbox(l.content,r+s+"_working_language","","",n.working_language),u.title=o("bundle","working_language_hover"),c=dom.span(l.content,"","",o("bundle","working_language")),c.title=o("bundle","working_language_hover")},e.refreshPersonName=function(n,a){var r=n.id,o=e.dom_element_prefix+r+"_person_"+a+"_name_disp",s=g(o),i=getObjectByID(n.persons.persons,a),l=i.person_id,d=t.getDisplayName(l);s.innerHTML=d},e.refreshPersonListInBundle=function(n,r){var s=n.id,i=g(e.dom_element_prefix+s+"_persons_addPersons_div");i.innerHTML="";var l=document.createElement("select");if(dom.setSelectOptions(l,t.persons.getAll(),"display_name","take_index"),t.persons.length>0&&(i.appendChild(l),dom.br(i),dom.button(i,"Add to bundle",function(e){return function(){a.addPerson(e,t.persons.idOf(l.selectedIndex))}}(s))),0===t.persons.length){var d=dom.h5(i,o("bundle","no_persons_created_yet")+"<br>");dom.link(d,"","",o("bundle","create_some_persons"),function(){APP.view("VIEW_persons")})}forAllItems(n.persons.persons,function(e){-1==r.indexOf(e.person_id)&&(console.log("There is an person in bundle with id"+s+" that does not exist anymore. Deleting!"),a.removePerson(s,e.id))})},e.refreshPersonLists=function(n,t){for(var a=getArrayWithIDs(t),r=0;r<e.pager.visible_items.length;r++)e.refreshPersonListInBundle(e.pager.visible_items[r],a)},e.displayNoBundleText=function(n){console.log("Showing no bundle text");var t=e.view_element;t.innerHTML="";var a=dom.make("h2","no_bundle_text","no_bundle_text",t);a.innerHTML=o("bundle","no_bundles_have_been_created_yet")+" "+o("bundle","why_not_create_one__before_link");var r=dom.make("a","new_bundle_link","new_bundle_link",a);r.innerHTML=o("bundle","why_not_create_one__link"),a.innerHTML+=o("bundle","why_not_create_one__after_link"),g("new_bundle_link").addEventListener("click",n),t.scrollTop=0},e.renderPerson=function(n,t){var r=n.id,o=t.id,s=""!==t.role?t.role:"Role";dom.make("div",e.dom_element_prefix+r+"_person_"+o,"person_in_bundle_wrap",g(e.dom_element_prefix+r+"_persons_persons"));var i=dom.make("div",e.dom_element_prefix+r+"_person_"+o+"_label","person_in_bundle",g(e.dom_element_prefix+r+"_person_"+o)),l=dom.h2(i);l.className="person_name_disp",l.id=e.dom_element_prefix+r+"_person_"+o+"_name_disp";APP.GUI.openVocabulary(i,void 0,"person_in_bundle_"+o+"_role_input","person_in_bundle_"+o+"_role_input",1,["Annotator","Author","Compiler","Consultant","Data_inputter","Depositor","Developer","Editor","Illustrator","Interpreter","Interviewee","Interviewer","Participant","Performer","Photographer","Recorder","Researcher","Research_participant","Responder","Signer","Singer","Speaker","Sponsor","Transcriber","Translator"],s,void 0,"person_role_input");e.refreshPersonName(n,o),APP.GUI.icon(g(e.dom_element_prefix+r+"_person_"+o),"delete_person_"+o+"_icon","delete_person_icon","reset",function(e,n){return function(){a.removePerson(e,n)}}(r,o))},e.renderResource=function(t,r){var s=t.id,i=t.urcs,l=n.resources.getByID(t.resource_id).name,d=dom.make("div",e.dom_element_prefix+r+"_resource_"+s,"mf",g(e.dom_element_prefix+r+"_resources_resources")),u=dom.h3(d);u.innerHTML=o("bundle","object");var c=APP.GUI.icon(d,"delete_resource_"+s+"_icon","delete_resource_icon","reset");c.addEventListener("click",function(e,n){return function(){a.removeResourceAndRefresh(e,n)}}(r,s)),dom.span(d,"","resource_file_content_span",o("bundle","file_name")+"<br><input type='text' value='"+l+"'><br>"),e.renderUCRS(d,e.dom_element_prefix+r+"_resource_"+s+"_",i)},e.renderUCRS=function(e,n,t){var a=dom.span(e,n+"oURCS");a.title=o("bundle","oURCS_description");var r=dom.input(a,n+"u","","","checkbox","u");dom.span(a,"","","U"),t.u===!0&&(r.checked=!0);var s=dom.input(a,n+"r","","","checkbox","r");dom.span(a,"","","R"),t.r===!0&&(s.checked=!0);var i=dom.input(a,n+"c","","","checkbox","c");dom.span(a,"","","C"),t.c===!0&&(i.checked=!0);var l=dom.input(a,n+"s","","","checkbox","s");dom.span(a,"","","S"),t.s===!0&&(l.checked=!0)},e.refreshBundleHeading=function(n){g(e.dom_element_prefix+n+"_label").innerHTML=""===r.bundles.getByID(n).bundle.title?o("bundle","unnamed_bundle"):o("bundle","bundle")+": "+get(e.dom_element_prefix+n+"_bundle_title")},e}(),eldp_environment.workflow[3]=function(){"use strict";var e,n,t,a={};a.parent=eldp_environment;var r=a.parent.l;return a.view_element,a.identity={id:"xml_output",title:"CMDI Output",icon:"data"},a.init=function(r){e=eldp_environment.workflow[2],n=eldp_environment.workflow[1],t=eldp_environment.workflow[0],a.view_element=r;var o=dom.h2(a.view_element,"","","");dom.link(o,"","","Download JSON of this project",APP.save_and_recall.saveActiveEnvironmentStateToFile)},a.view=function(){return APP.save(),0===e.bundles.length?(APP.alert(r("output","you_must_create_some_bundles_first")),void APP.view(e)):n.areAllPersonsNamed()?e.areAllBundlesProperlyNamed()?e.doAllBundlesHaveIDs()?e.doAllBundlesHaveALanguage()?void a.generate():(APP.view(e),void APP.alert(r("output","bundles_must_have_one_language"))):(APP.view(e),void APP.alert(r("output","bundles_must_have_ids"))):(APP.view(e),void APP.alert(r("output","bundles_must_have_proper_name"))):(APP.view(n),void APP.alert(r("output","persons_must_have_proper_name")))},a.functions=function(){return[{id:"link_export_corpus",icon:"download",label:"Download All Bundles",onclick:function(){APP.saveAllOutputFiles()}},{id:"link_export_bundles_as_zip",icon:"download",label:r("output","download_zip_archive"),onclick:function(){APP.zipAllOutputFiles()}}]},a.generate=function(){var a,r=g("VIEW_xml_output");r.innerHTML="";for(var o={bundles:e.bundles.getAll(),persons:n.persons,resources:t.resources},s=eldp_environment.eldp_generator(o),i=0;i<e.bundles.length;i++)a=e.bundles.get(i).bundle.id_element+".cmdi",APP.GUI.createXMLOutputDIV(r,"CMDI Bundle "+(i+1),"textarea_bundle_"+i,s.bundles[i],a,!1)},a}(),eldp_environment.eldp_generator=function(e){"use strict";var n,t="clarin.eu:cr1:p_1407745711992",a="ISO639-3:",r=new XMLString,o=[],s=function(){var e=strings.randomString(8,"0123456789abcdefghijklmnopqrstuvwxyz"),n=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),t=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),a=strings.randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),r=strings.randomString(12,"0123456789abcdefghijklmnopqrstuvwxyz");return"res_"+e+"_"+n+"_"+t+"_"+a+"_"+r},i=function(e,n,t){r.open("Header"),r.element("MdCreator",e),r.element("MdCreationDate",n),r.element("MdProfile",t),r.close("Header")},l=function(){return["xml:lang",get("metadata_language_select")]},d=function(e){r.open("ContentLanguages"),forEach(e,function(e){r.open("ContentLanguage"),r.element("Name",e.name),r.element("Code",a+e.code),e.content_language===!0?r.element("Use","Content"):r.element("Use","Working"),r.close("ContentLanguage")}),r.close("ContentLanguages")},u=function(){function e(e,n){for(var t=""+e;t.length<n;)t="0"+t;return t}var n=(new Date).getTimezoneOffset();return n=(0>n?"+":"-")+e(parseInt(Math.abs(n/60)),2)+":"+e(Math.abs(n%60),2)},c=function(e,n,a){if(r.reset(),r.header(),r.open("CMD",[["xmlns","http://www.clarin.eu/cmd/"],["xmlns:cmd","http://www.clarin.eu/cmd/"],["xmlns:dcr","http://www.isocat.org/ns/dcr"],["xmlns:ann","http://www.clarin.eu"],["xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"],["xsi:schemaLocation","http://www.clarin.eu/cmd/ http://catalog.clarin.eu/ds/ComponentRegistry/rest/registry/profiles/"+t+"/xsd"],["CMDVersion","1.1"]]),i(get("metadata_creator"),dates.today()+u(),t),r.open("Resources"),e.resources.resources.length>0){r.open("ResourceProxyList");for(var c=0;c<e.resources.resources.length;c++)o.push(s()),r.open("ResourceProxy",[["id",o[c]]]),r.element("ResourceType","Resource"),console.log(a),r.element("ResourceRef",a.getByID(e.resources.resources[c].resource_id).name),r.close("ResourceProxy");r.close("ResourceProxyList")}else r.element("ResourceProxyList","");r.element("JournalFileProxyList",""),r.element("ResourceRelationList",""),r.close("Resources"),r.open("Components"),r.open("ELDP_Bundle"),r.element("Title",e.bundle.title),r.element("ID",e.bundle.id_element),r.element("Description",e.bundle.description,[l()]),r.open("StatusInfo"),r.element("Status","in-progress"),r.element("ChangeDate",dates.today()),r.close("StatusInfo"),m(),d(e.languages.bundle_languages),_(e.content.genre),b(e.content.keywords),f(e.persons.persons,n,e),r.open("ProjectLocations"),r.open("ProjectLocation"),r.element("Name",e.bundle.location.name),r.open("ProjectGeographic"),r.element("Country",e.bundle.location.country),r.close("ProjectGeographic"),r.close("ProjectLocation"),r.close("ProjectLocations"),y(e.resources.resources,a,e.languages.bundle_languages,e.persons.persons,n,e),r.close("ELDP_Bundle"),r.close("Components"),r.close("CMD")},_=function(e){""!=e&&(r.open("Genres"),r.element("Genre",e),r.close("Genres"))},m=function(){r.open("Depositors"),r.open("Depositor"),r.element("Role","Depositor"),r.element("AdditionalInformation",""),r.open("PersonalData"),r.open("Name"),r.element("Name",""),r.close("Name"),r.open("BiographicalData"),r.close("BiographicalData"),r.close("PersonalData"),r.element("Gender",""),r.open("Languages"),r.open("Language"),r.element("Name",""),r.element("Autoglottonym",""),r.close("Language"),r.close("Languages"),r.close("Depositor"),r.close("Depositors")},p=function(e){0!=e.length&&(r.open("Languages"),forEach(e,function(e){r.open("Language"),r.element("Name",e.name),r.element("Code",a+e.iso_code),r.element("Additional_Information",e.additional_information),r.close("Language")}),r.close("Languages"))},f=function(e,n,t){0!==e.length&&(r.open("Persons"),forEach(e,function(e){var a=n.getByID(e.person_id);if(r.open("Person"),r.element("PersonID",""),""!==t.bundle.date.year&&"YYYY"!==t.bundle.date.year){var o=t.bundle.date.year-a.birth_year;"number"!=typeof o||isNaN(o)||r.element("Age_at_Time_of_Recording",o)}r.element("Role",e.role),r.element("AdditionalInformation",a.person_additional_information),r.element("BiographicalNote",a.biographical_note);var s=strings.linesToArray(a.ethnicity),i=strings.linesToArray(a.ethnicity_additional_info);if(s.length==i.length&&0!=s.length)for(var l=0;l<s.length;l++)r.open("Ethnicity"),r.element("EthnicAffiliation",s[l]),r.element("AdditionalInformation",i[l]),r.close("Ethnicity");r.open("PersonalData"),r.open("Name"),r.element("Title",a.title),""!==a.nameKnownAs&&r.element("Name",a.nameKnownAs,[["kind","KnownAs"]]),""!==a.fullName&&r.element("Name",a.fullName,[["kind","FullName"]]),""!==a.nameSortBy&&r.element("Name",a.nameSortBy,[["kind","asSortBy"]]),r.close("Name"),r.open("BiographicalData"),"YYYY"!=a.birth_year&&""!=a.birth_year&&r.element("BirthYear",a.birth_year),"YYYY"!=a.death_year&&""!=a.death_year&&r.element("DeathYear",a.death_year),r.close("BiographicalData"),r.close("PersonalData"),r.open("Gender"),r.element("GenderIdentification",a.gender),r.element("AdditionalInformation",""),r.close("Gender"),r.open("Education"),r.element("Level",a.education),r.element("AdditionalInformation",""),r.close("Education"),p(a.languages.actor_languages);var d=strings.linesToArray(a.nationality),u=strings.linesToArray(a.nationality_additional_info);if(d.length==u.length&&0!=d.length)for(var l=0;l<d.length;l++)r.open("Nationality"),r.element("Name",d[l]),r.element("AdditionalInformation",u[l]),r.close("Nationality");r.close("Person")}),r.close("Persons"))},g=function(e,n,t,a,o,s,i){log(e),r.open("Resource",[["ref",i]]),r.element("Title",n.name),r.element("ID",""),r.element("Host",""),r.open("StatusInfo"),r.element("Status",n.status),r.element("ChangeDate",dates.today()),r.close("StatusInfo"),m(),d(t),_(s.content.genre),b(s.content.keywords),f(a,o,s),r.open("AccessInformation"),r.element("Restrictions",s.resources.access_restrictions),r.element("ConditionsofAccess",s.resources.access_conditions);var l="Open Access";1==e.urcs.u&&(l="User"),1==e.urcs.r&&(l="Researcher"),1==e.urcs.c&&(l="Community member"),1==e.urcs.s&&(l="Subscriber"),r.element("oURCS",l),r.close("AccessInformation"),h(n),r.close("Resource")},h=function(e){var n={eaf:"TextFile",txt:"TextFile",jpg:"ImageFile",png:"ImageFile",tif:"ImageFile",bmp:"ImageFile",wav:"AudioFile",mp4:"VideoFile",avi:"VideoFile"},t=strings.getFileTypeFromFilename(e.name);if(n[t])var a=n[t];else a="TextFile";r.open("File"),r.open(a),r.open("General"),r.element("Name",e.name);var o=dates.parseDate(e.lastModified);if(null!=o)var s=dates.dateAsString(o);else s="1977-01-01";switch(r.element("Date",s),r.close("General"),a){case"ImageFile":r.element("ImageInformations","");break;case"AudioFile":r.element("MediaInformations","");break;case"VideoFile":r.element("MediaInformations",""),r.element("ImageInformations",""),r.element("VideoInformations","")}r.element("Checksum",""),r.close(a),r.close("File")},b=function(e){if(e=strings.linesToArray(e),0==e.length||1==e.length&&""==e[0])return"";r.open("Keywords");for(var n=0;n<e.length;n++)r.element("Keyword",e[n]);r.close("Keywords")},y=function(e,t,a,s,i,l){0!==e.length&&(r.open("Resources"),forEach(e,function(e){var r=t.getByID(e.resource_id);g(e,r,a,s,i,l,o[n]),n+=1}),r.close("Resources"))},v={};return v.bundles=map(e.bundles,function(t){return r.reset(),n=0,c(t,e.persons,e.resources),r.getString()}),v},eldp_environment.repair=function(e){"use strict";var n,t=e;forEach(t.environments.eldp.resources,function(e,n){e.id=n,e.status=e.stable?"stable":"in-progress"}),Array.isArray(t.environments.eldp.resources)&&(t.environments.eldp.resources=new ObjectList(t.environments.eldp.resources).getState(),log("eldp.resources was array. turned it into ObjectList")),Array.isArray(t.environments.eldp.persons.persons)&&(forEach(t.environments.eldp.persons.persons,function(e){Array.isArray(e.languages)&&(n=e.languages,e.languages={},e.languages.actor_languages=n,log("corrected location of person languages")),"undefined"==typeof e.languages.actor_languages&&(e.languages.actor_languages=[],log("person languages undefined! turning it into an empty array")),e.sex&&(e.gender=e.sex),e.old_id=e.id}),t.environments.eldp.persons.persons=new ObjectList(t.environments.eldp.persons.persons).getState(),log("eldp.persons.persons was array. turned it into ObjectList")),Array.isArray(t.environments.eldp.bundle)&&(n=t.environments.eldp.bundle,t.environments.eldp.bundle={},t.environments.eldp.bundle.bundles=n,log("bundles array was at wrong position. corrected!"));var a=function(e){for(var n=0;n<t.environments.eldp.persons.persons.list.length;n++)if(t.environments.eldp.persons.persons.list[n].old_id==e){var a=t.environments.eldp.persons.persons.list[n].id;return log("mapped old person id to id. old="+e+", new="+a),a}return-1};return Array.isArray(t.environments.eldp.bundle.bundles)&&(forEach(t.environments.eldp.bundle.bundles,function(e){e.bundle.location.name=e.bundle.location.region,forEach(e.resources.resources,function(e){e.resource_id=e.resource_file_index}),e.content.languages&&(e.languages=e.content.languages),forEach(e.persons.persons,function(e){e.person_id=a(e.person_id?e.person_id:e.id)}),log("corrected bundle")}),t.environments.eldp.bundle.bundles=new ObjectList(t.environments.eldp.bundle.bundles).getState(),log("eldp.bundle.bundles was array. turned it into ObjectList")),t};